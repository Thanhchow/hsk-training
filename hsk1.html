<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSK 1 Mock Test - Smart Auto Gen</title>
    
    <link rel="icon" type="image/png" href="favicon-32x32.png">
    <meta name="theme-color" content="#ffffff">

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root { 
            --primary: #2C3E50; 
            --accent: #FF4757; 
            --bg: #F0F2F5; 
            --white: #fff; 
            --success: #2ED573; 
            --warning: #FFA502; 
        }
        body { font-family: 'Montserrat', 'Noto Sans SC', sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; color: #333; }

        /* HEADER */
        .header { background: var(--white); padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); height: 60px; z-index: 20; }
        .back-btn { font-weight: 700; cursor: pointer; color: var(--primary); display: flex; align-items: center; gap: 5px; transition: 0.2s; }
        .back-btn:hover { color: var(--accent); }
        .timer-box { background: var(--primary); color: white; padding: 8px 20px; border-radius: 50px; font-weight: bold; font-size: 1.1rem; box-shadow: 0 4px 10px rgba(44, 62, 80, 0.2); font-variant-numeric: tabular-nums; }

        /* START SCREEN */
        #start-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 100; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; }
        .start-card { max-width: 500px; width: 90%; padding: 40px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); background: white; border-top: 6px solid var(--accent); }
        .info-box { text-align: left; margin: 30px 0; background: #f8f9fa; padding: 20px; border-radius: 12px; border: 1px solid #eee; }
        .info-box p { margin: 8px 0; font-size: 0.95rem; display: flex; align-items: center; gap: 10px; }
        .start-btn { background: var(--accent); color: white; border: none; padding: 15px 50px; border-radius: 50px; font-size: 1.1rem; font-weight: 800; cursor: pointer; margin-top: 20px; transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 5px 15px rgba(255, 71, 87, 0.3); }
        .start-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(255, 71, 87, 0.4); }

        /* LAYOUT */
        .main-container { display: flex; flex: 1; overflow: hidden; position: relative; }
        .question-area { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; align-items: center; }
        .question-card { background: white; width: 100%; max-width: 800px; border-radius: 16px; padding: 35px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); margin-bottom: 90px; transition: all 0.3s; position: relative; border: 1px solid #eee; }

        /* --- THEME V√ç D·ª§ (EXAMPLE MODE) --- */
        .question-card.example-mode { 
            border: 3px dashed #FFC107; /* Vi·ªÅn n√©t ƒë·ª©t */
            background-color: #FFFDE7; /* N·ªÅn v√†ng nh·∫°t */
            overflow: hidden; 
        }
        .question-card.example-mode::before {
            content: "V√ç D·ª§ M·∫™U"; /* Watermark */
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            font-size: 4rem; font-weight: 900;
            color: rgba(255, 193, 7, 0.15); /* M√†u r·∫•t m·ªù */
            pointer-events: none; white-space: nowrap; z-index: 0;
        }
        .question-card.example-mode > * { position: relative; z-index: 1; }
        .example-tag { background: #FFC107; color: #444; padding: 6px 15px; border-radius: 50px; font-weight: 800; font-size: 0.85rem; margin-bottom: 15px; display: inline-flex; align-items: center; gap: 6px; box-shadow: 0 3px 10px rgba(255, 193, 7, 0.3); }

        /* CONTENT */
        .section-badge { display: inline-block; background: #FFEBEE; color: var(--accent); padding: 5px 15px; border-radius: 20px; font-weight: 700; margin-bottom: 15px; font-size: 0.85rem; letter-spacing: 0.5px; }
        .q-text { font-size: 1.4rem; font-weight: 700; margin-bottom: 25px; color: var(--primary); line-height: 1.4; }
        
        .q-image-container { text-align: center; margin: 15px 0; }
        .q-image-container img { max-height: 220px; border-radius: 12px; border: 2px solid #eee; object-fit: contain; background: #fff; }

        /* AUDIO */
        .audio-control { background: #f1f3f5; padding: 12px 25px; border-radius: 50px; display: flex; align-items: center; gap: 12px; cursor: pointer; border: 1px solid #e9ecef; margin-bottom: 25px; width: fit-content; transition: 0.2s; user-select: none; }
        .audio-control:hover { background: #e2e6ea; transform: scale(1.02); }
        .audio-icon { font-size: 1.4rem; }
        .audio-label { font-weight: 600; font-size: 0.95rem; color: #495057; }

        /* OPTIONS */
        .options-grid { display: grid; gap: 15px; margin-top: 20px; width: 100%; }
        
        /* Text Options */
        .option-btn { padding: 18px 20px; border: 2px solid #f1f3f5; border-radius: 12px; background: white; cursor: pointer; text-align: left; display: flex; align-items: center; gap: 15px; transition: 0.2s; font-size: 1.05rem; }
        .option-btn:hover { border-color: var(--primary); background: #f8fbff; }
        .option-btn.selected { border-color: var(--accent); background: #FFF0F0; color: var(--accent); font-weight: 700; }
        .option-key { width: 32px; height: 32px; border-radius: 50%; background: #eee; display: flex; justify-content: center; align-items: center; font-weight: bold; flex-shrink: 0; font-size: 0.9rem; color: #555; }
        .option-btn.selected .option-key { background: var(--accent); color: white; }

        /* Image Options */
        .options-grid.image-mode { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }
        .option-image-card { border: 2px solid #f1f3f5; border-radius: 12px; cursor: pointer; overflow: hidden; transition: 0.2s; position: relative; background: white; display:flex; flex-direction:column; }
        .option-image-card:hover { border-color: var(--primary); transform: translateY(-4px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .option-image-card.selected { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(255, 71, 87, 0.2); }
        .option-image-card img { width: 100%; height: 160px; object-fit: cover; display: block; background: #f9f9f9; }
        .img-key { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: bold; backdrop-filter: blur(2px); }
        .option-image-card.selected .img-key { background: var(--accent); }

        /* SIDEBAR */
        .sidebar { width: 320px; background: white; border-left: 1px solid #e9ecef; display: flex; flex-direction: column; z-index: 10; box-shadow: -2px 0 10px rgba(0,0,0,0.02); }
        .q-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; padding: 15px; }
        .q-dot { aspect-ratio: 1; border-radius: 8px; background: #f8f9fa; display: flex; justify-content: center; align-items: center; cursor: pointer; font-size: 0.9rem; font-weight: 700; color: #adb5bd; border: 1px solid transparent; transition: 0.2s; }
        .q-dot:hover { background: #e9ecef; color: #495057; }
        .q-dot.active { border: 2px solid var(--accent); background: white; color: var(--accent); }
        .q-dot.answered { background: var(--primary); color: white; }

        /* NAV BUTTONS */
        .nav-buttons { position: fixed; bottom: 0; left: 0; right: 320px; padding: 15px 30px; background: white; border-top: 1px solid #e9ecef; display: flex; justify-content: space-between; align-items: center; z-index: 15; }
        .nav-btn { padding: 12px 30px; border-radius: 50px; border: none; cursor: pointer; font-weight: 700; transition: 0.2s; }
        .btn-prev { background: #f1f3f5; color: #495057; }
        .btn-prev:hover { background: #e9ecef; }
        .btn-next { background: var(--primary); color: white; }
        .btn-next:hover { background: #1a252f; box-shadow: 0 4px 10px rgba(44, 62, 80, 0.3); }

        .submit-area { padding: 20px; border-top: 1px solid #e9ecef; background: #f8f9fa; }
        .submit-btn { width: 100%; padding: 15px; background: var(--accent); color: white; border: none; border-radius: 50px; font-weight: 800; font-size: 1.1rem; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3); }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(255, 71, 87, 0.4); }

        /* RESPONSIVE */
        @media (max-width: 900px) {
            .sidebar { display: none; position: fixed; top: 0; right: 0; height: 100%; box-shadow: -5px 0 20px rgba(0,0,0,0.1); width: 85%; z-index: 100; }
            .sidebar.open { display: flex; }
            .nav-buttons { right: 0; padding: 10px 20px; }
            .question-card { padding: 20px; width: 95%; }
            .option-btn { padding: 15px; font-size: 1rem; }
            .options-grid.image-mode { grid-template-columns: repeat(2, 1fr); }
        }

        /* MODAL */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-content { background: white; padding: 40px; border-radius: 24px; text-align: center; max-width: 380px; width: 90%; position: relative; animation: slideUp 0.3s ease; }
        .score-circle { width: 140px; height: 140px; border-radius: 50%; border: 8px solid var(--accent); margin: 0 auto 20px; display: flex; justify-content: center; align-items: center; font-size: 3rem; font-weight: 900; color: var(--accent); flex-direction: column; }
        .score-sub { font-size: 1rem; font-weight: 600; color: #adb5bd; margin-top: -5px; }
        @keyframes slideUp { from {transform: translateY(20px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }
    </style>
</head>
<body>

    <div id="start-screen">
        <div class="start-card">
            <h1 style="color:var(--primary); margin:0 0 10px 0; font-size:2rem;">HSK 1 MOCK TEST</h1>
            <p style="color:#868e96; font-weight:600;">H·ªá th·ªëng m√¥ ph·ªèng ƒë·ªÅ thi th·∫≠t</p>
            
            <div class="info-box">
                <p>üìù <b>S·ªë l∆∞·ª£ng:</b> 40 c√¢u h·ªèi</p>
                <p>‚è± <b>Th·ªùi gian:</b> 40 ph√∫t</p>
                <p>üéß <b>K·ªπ nƒÉng:</b> Nghe hi·ªÉu & ƒê·ªçc hi·ªÉu</p>
                <p>üí° <b>L∆∞u √Ω:</b> C√°c c√¢u "V√≠ d·ª•" kh√¥ng t√≠nh ƒëi·ªÉm.</p>
                <p>üé≤ <b>Tr·∫°ng th√°i:</b> ƒê·ªÅ thi m·ªõi ƒë√£ ƒë∆∞·ª£c sinh ng·∫´u nhi√™n!</p>
            </div>
            
            <button class="start-btn" onclick="startExam()">B·∫ÆT ƒê·∫¶U L√ÄM B√ÄI</button>
            <div style="margin-top:20px; cursor:pointer; color:#adb5bd; font-weight:600; font-size:0.9rem;" onclick="window.location.href='index.html'">Quay l·∫°i trang ch·ªß</div>
        </div>
    </div>

    <div class="header">
        <div class="back-btn" onclick="if(confirm('B·∫°n c√≥ ch·∫Øc mu·ªën tho√°t? K·∫øt qu·∫£ s·∫Ω kh√¥ng ƒë∆∞·ª£c l∆∞u.')) window.location.href='index.html'">
            <span style="font-size:1.2rem">‚¨Ö</span> Tho√°t
        </div>
        <div class="timer-box">‚è± <span id="timer">40:00</span></div>
        <div style="font-weight:900; color:var(--primary); font-size:1.1rem; cursor:pointer" onclick="toggleSidebar()">‚ò∞ MENU</div>
    </div>

    <div class="main-container">
        <div class="question-area">
            <div class="question-card" id="q-card">
                <div id="example-tag" style="display:none;" class="example-tag">üí° V√ç D·ª§ M·∫™U (KH√îNG T√çNH ƒêI·ªÇM)</div>
                
                <div class="section-badge" id="section-badge">Ph·∫ßn thi</div>
                
                <div class="audio-control" id="audio-control" onclick="playAudio()">
                    <span class="audio-icon">üîä</span> 
                    <span class="audio-label" id="audio-text">B·∫•m ƒë·ªÉ nghe c√¢u h·ªèi</span>
                </div>

                <div id="question-content"></div>

                <div class="options-grid" id="options-container"></div>
            </div>

            <div class="nav-buttons">
                <button class="nav-btn btn-prev" onclick="prevQuestion()">C√¢u tr∆∞·ªõc</button>
                <button class="nav-btn btn-next" onclick="nextQuestion()">C√¢u ti·∫øp theo</button>
            </div>
        </div>

        <div class="sidebar" id="sidebar">
            <div style="padding:15px 20px; border-bottom:1px solid #e9ecef; font-weight:800; color:var(--primary); display:flex; justify-content:space-between; align-items:center;">
                DANH S√ÅCH C√ÇU H·ªéI
                <span onclick="toggleSidebar()" style="cursor:pointer; font-size:1.5rem; display:none;" id="close-sidebar">√ó</span>
            </div>
            <div style="flex:1; overflow-y:auto; padding:10px;">
                <div style="font-size:0.75rem; font-weight:800; color:#adb5bd; margin:15px 0 8px 15px; letter-spacing:1px;">PH·∫¶N NGHE HI·ªÇU (1-20)</div>
                <div class="q-grid" id="grid-listening"></div>
                
                <div style="font-size:0.75rem; font-weight:800; color:#adb5bd; margin:25px 0 8px 15px; letter-spacing:1px;">PH·∫¶N ƒê·ªåC HI·ªÇU (21-40)</div>
                <div class="q-grid" id="grid-reading"></div>
            </div>
            <div class="submit-area">
                <button class="submit-btn" onclick="submitTest()">N·ªòP B√ÄI THI</button>
            </div>
        </div>
    </div>

    <div id="resultModal" class="modal">
        <div class="modal-content">
            <h2 style="color:var(--primary); margin:0 0 5px 0;">K·∫æT QU·∫¢ THI</h2>
            <p style="color:#868e96; font-size:0.9rem; margin-bottom:25px;">HSK 1 Mock Test</p>
            
            <div class="score-circle">
                <span id="final-score">0</span>
                <span class="score-sub">/ 200</span>
            </div>
            
            <p id="pass-msg" style="font-weight:700; font-size:1.2rem; margin:20px 0;"></p>
            
            <button class="submit-btn" style="margin-bottom:10px;" onclick="location.reload()">üîÑ L√†m ƒê·ªÅ M·ªõi</button>
            <button class="submit-btn" style="background:white; color:#555; border:2px solid #eee; box-shadow:none;" onclick="window.location.href='index.html'">V·ªÅ Trang Ch·ªß</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
        import { getFirestore, doc, updateDoc, arrayUnion, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBgc-OYf_lq9bTu_lQv46XbYtnEp4SBynY",
            authDomain: "hsk-plus-web.firebaseapp.com",
            projectId: "hsk-plus-web",
            storageBucket: "hsk-plus-web.firebasestorage.app",
            messagingSenderId: "757004452643",
            appId: "1:757004452643:web:cbef488f9d7699ac034296",
            measurementId: "G-8XVEFW19DQ"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let currentUser = null;

        onAuthStateChanged(auth, (user) => {
            if(user) currentUser = user;
        });

        window.saveTestResult = async function(score, total) {
            if (!currentUser) return;
            const userRef = doc(db, "users", currentUser.uid);
            try {
                const docSnap = await getDoc(userRef);
                const data = { 
                    testName: "HSK 1 Mock (Random)", 
                    score: score, 
                    total: total, 
                    date: new Date().toISOString(), 
                    pass: score >= 120 
                };
                
                if (!docSnap.exists()) {
                    await setDoc(userRef, { testHistory: [data] });
                } else {
                    await updateDoc(userRef, { testHistory: arrayUnion(data) });
                }
            } catch (e) { console.error("Firebase Error:", e); }
        }
    </script>

    <script>
        // 1. DATA: 150 T·ª™ V·ª∞NG HSK 1 (ƒê√É S·ª¨A C√ö PH√ÅP JS CHU·∫®N)
        const hsk1_vocab = [
            {"word": "Êàë", "pinyin": "w«í", "meaning": "I/Me", "sentence": "W«í sh√¨ xu√©shƒìng", "category": "pronoun"},
            {"word": "Êàë‰ª¨", "pinyin": "w«ímen", "meaning": "We/Us", "sentence": "W«ímen q√π xu√©xi√†o", "category": "pronoun"},
            {"word": "‰Ω†", "pinyin": "n«ê", "meaning": "You", "sentence": "N«ê h«éo ma?", "category": "pronoun"},
            {"word": "‰ªñ", "pinyin": "tƒÅ", "meaning": "He/Him", "sentence": "TƒÅ sh√¨ w«í p√©ngyou", "category": "pronoun"},
            {"word": "Â•π", "pinyin": "tƒÅ", "meaning": "She/Her", "sentence": "TƒÅ hƒõn pi√†oliang", "category": "pronoun"},
            {"word": "Áà∏Áà∏", "pinyin": "b√†ba", "meaning": "Dad", "sentence": "W«í b√†ba sh√¨ yƒ´shƒìng", "category": "noun"},
            {"word": "Â¶àÂ¶à", "pinyin": "mƒÅma", "meaning": "Mom", "sentence": "W«í √†i mƒÅma", "category": "noun"},
            {"word": "ÂÑøÂ≠ê", "pinyin": "√©rzi", "meaning": "Son", "sentence": "TƒÅ y«íu yƒ´ ge √©rzi", "category": "noun"},
            {"word": "Â•≥ÂÑø", "pinyin": "n«ö'√©r", "meaning": "Daughter", "sentence": "Zh√® sh√¨ w«í n«ö'√©r", "category": "noun"},
            {"word": "ËÄÅÂ∏à", "pinyin": "l«éoshƒ´", "meaning": "Teacher", "sentence": "L«éoshƒ´ h«éo", "category": "noun"},
            {"word": "Â≠¶Áîü", "pinyin": "xu√©shƒìng", "meaning": "Student", "sentence": "W«ímen sh√¨ xu√©shƒìng", "category": "noun"},
            {"word": "ÂêåÂ≠¶", "pinyin": "t√≥ngxu√©", "meaning": "Classmate", "sentence": "TƒÅ sh√¨ w«í t√≥ngxu√©", "category": "noun"},
            {"word": "ÊúãÂèã", "pinyin": "p√©ngyou", "meaning": "Friend", "sentence": "N«ê sh√¨ w«í de h«éo p√©ngyou", "category": "noun"},
            {"word": "ÂåªÁîü", "pinyin": "yƒ´shƒìng", "meaning": "Doctor", "sentence": "W«í q√π k√†n yƒ´shƒìng", "category": "noun"},
            {"word": "ÂÖàÁîü", "pinyin": "xiƒÅnsheng", "meaning": "Mr./Sir", "sentence": "W√°ng xiƒÅnsheng z√†i ma?", "category": "noun"},
            {"word": "Â∞èÂßê", "pinyin": "xi«éojiƒõ", "meaning": "Miss", "sentence": "L«ê xi«éojiƒõ hƒõn gƒÅox√¨ng", "category": "noun"},
            {"word": "‰∫∫", "pinyin": "r√©n", "meaning": "Person", "sentence": "Zh≈çnggu√≥ r√©n", "category": "noun"},
            {"word": "ÂêçÂ≠ó", "pinyin": "m√≠ngzi", "meaning": "Name", "sentence": "N«ê ji√†o sh√©nme m√≠ngzi?", "category": "noun"},
            {"word": "‰π¶", "pinyin": "sh≈´", "meaning": "Book", "sentence": "W«í k√†n sh≈´", "category": "noun"},
            {"word": "Ê§ÖÂ≠ê", "pinyin": "y«êzi", "meaning": "Chair", "sentence": "Zh√® sh√¨ sh√©i de y«êzi?", "category": "noun"},
            {"word": "Ê°åÂ≠ê", "pinyin": "zhu≈çzi", "meaning": "Table", "sentence": "Sh≈´ z√†i zhu≈çzi sh√†ng", "category": "noun"},
            {"word": "ÊùØÂ≠ê", "pinyin": "bƒìizi", "meaning": "Cup", "sentence": "Yƒ´ ge bƒìizi", "category": "noun"},
            {"word": "ÁîµËÑë", "pinyin": "di√†nn«éo", "meaning": "Computer", "sentence": "W«í m«éi di√†nn«éo", "category": "noun"},
            {"word": "ÁîµËßÜ", "pinyin": "di√†nsh√¨", "meaning": "Television", "sentence": "K√†n di√†nsh√¨", "category": "noun"},
            {"word": "ÁîµÂΩ±", "pinyin": "di√†ny«êng", "meaning": "Movie", "sentence": "Q√π k√†n di√†ny«êng", "category": "noun"},
            {"word": "È£ûÊú∫", "pinyin": "fƒìijƒ´", "meaning": "Airplane", "sentence": "W«í zu√≤ fƒìijƒ´", "category": "noun"},
            {"word": "Âá∫ÁßüËΩ¶", "pinyin": "ch≈´z≈´chƒì", "meaning": "Taxi", "sentence": "W«í ji√†o ch≈´z≈´chƒì", "category": "noun"},
            {"word": "ÂÆ∂", "pinyin": "jiƒÅ", "meaning": "Home/Family", "sentence": "W«í hu√≠ jiƒÅ", "category": "noun"},
            {"word": "Â≠¶Ê†°", "pinyin": "xu√©xi√†o", "meaning": "School", "sentence": "W«í q√π xu√©xi√†o", "category": "noun"},
            {"word": "È•≠Â∫ó", "pinyin": "f√†ndi√†n", "meaning": "Restaurant/Hotel", "sentence": "Q√π f√†ndi√†n chƒ´ f√†n", "category": "noun"},
            {"word": "ÂïÜÂ∫ó", "pinyin": "shƒÅngdi√†n", "meaning": "Shop/Store", "sentence": "TƒÅ z√†i shƒÅngdi√†n m«éi d≈çngxi", "category": "noun"},
            {"word": "ÂåªÈô¢", "pinyin": "yƒ´yu√†n", "meaning": "Hospital", "sentence": "Yƒ´yu√†n z√†i n«ér?", "category": "noun"},
            {"word": "ÁÅ´ËΩ¶Á´ô", "pinyin": "hu«íchƒìzh√†n", "meaning": "Train Station", "sentence": "W«í q√π hu«íchƒìzh√†n", "category": "noun"},
            {"word": "‰∏≠ÂõΩ", "pinyin": "Zh≈çnggu√≥", "meaning": "China", "sentence": "W«í √†i Zh≈çnggu√≥", "category": "noun"},
            {"word": "Âåó‰∫¨", "pinyin": "Bƒõijƒ´ng", "meaning": "Beijing", "sentence": "W«í zh√π z√†i Bƒõijƒ´ng", "category": "noun"},
            {"word": "‰∏úË•ø", "pinyin": "d≈çngxi", "meaning": "Thing", "sentence": "M«éi d≈çngxi", "category": "noun"},
            {"word": "Èí±", "pinyin": "qi√°n", "meaning": "Money", "sentence": "Du≈çsh«éo qi√°n?", "category": "noun"},
            {"word": "Ê∞¥", "pinyin": "shu«ê", "meaning": "Water", "sentence": "Hƒì shu«ê", "category": "noun"},
            {"word": "Ëå∂", "pinyin": "ch√°", "meaning": "Tea", "sentence": "Hƒì ch√°", "category": "noun"},
            {"word": "Á±≥È•≠", "pinyin": "m«êf√†n", "meaning": "Rice", "sentence": "Chƒ´ m«êf√†n", "category": "noun"},
            {"word": "Ëèú", "pinyin": "c√†i", "meaning": "Dish/Vegetable", "sentence": "H«éochƒ´ de c√†i", "category": "noun"},
            {"word": "Ê∞¥Êûú", "pinyin": "shu«êgu«í", "meaning": "Fruit", "sentence": "Chƒ´ shu«êgu«í", "category": "noun"},
            {"word": "ËãπÊûú", "pinyin": "p√≠nggu«í", "meaning": "Apple", "sentence": "Zh√®ge p√≠nggu«í hƒõn d√†", "category": "noun"},
            {"word": "Áå´", "pinyin": "mƒÅo", "meaning": "Cat", "sentence": "W«í x«êhuan mƒÅo", "category": "noun"},
            {"word": "Áãó", "pinyin": "g«íu", "meaning": "Dog", "sentence": "N√† sh√¨ w«í de g«íu", "category": "noun"},
            {"word": "Ë°£Êúç", "pinyin": "yƒ´fu", "meaning": "Clothes", "sentence": "Pi√†oliang de yƒ´fu", "category": "noun"},
            {"word": "Â§©Ê∞î", "pinyin": "tiƒÅnq√¨", "meaning": "Weather", "sentence": "TiƒÅnq√¨ hƒõn h«éo", "category": "noun"},
            {"word": "Â≠ó", "pinyin": "z√¨", "meaning": "Character", "sentence": "H√†nz√¨", "category": "noun"},
            {"word": "Ê±âËØ≠", "pinyin": "H√†ny«î", "meaning": "Chinese language", "sentence": "W«í xu√© H√†ny«î", "category": "noun"},
            {"word": "‰∏Ä", "pinyin": "yƒ´", "meaning": "One", "sentence": "Yƒ´ ge r√©n", "category": "number"},
            {"word": "‰∫å", "pinyin": "√®r", "meaning": "Two", "sentence": "√àr bƒõn sh≈´", "category": "number"},
            {"word": "‰∏â", "pinyin": "sƒÅn", "meaning": "Three", "sentence": "SƒÅn ge", "category": "number"},
            {"word": "Âõõ", "pinyin": "s√¨", "meaning": "Four", "sentence": "S√¨ di«én", "category": "number"},
            {"word": "‰∫î", "pinyin": "w«î", "meaning": "Five", "sentence": "W«î tiƒÅn", "category": "number"},
            {"word": "ÂÖ≠", "pinyin": "li√π", "meaning": "Six", "sentence": "Li√π ge", "category": "number"},
            {"word": "‰∏É", "pinyin": "qƒ´", "meaning": "Seven", "sentence": "Qƒ´ yu√®", "category": "number"},
            {"word": "ÂÖ´", "pinyin": "bƒÅ", "meaning": "Eight", "sentence": "BƒÅ ge", "category": "number"},
            {"word": "‰πù", "pinyin": "ji«î", "meaning": "Nine", "sentence": "Ji«î di«én", "category": "number"},
            {"word": "ÂçÅ", "pinyin": "sh√≠", "meaning": "Ten", "sentence": "Sh√≠ ge", "category": "number"},
            {"word": "Èõ∂", "pinyin": "l√≠ng", "meaning": "Zero", "sentence": "√àr l√≠ng √®r li√π", "category": "number"},
            {"word": "ÁÇπ", "pinyin": "di«én", "meaning": "O'clock/Dot", "sentence": "BƒÅ di«én", "category": "time"},
            {"word": "ÂàÜÈíü", "pinyin": "fƒìnzh≈çng", "meaning": "Minute", "sentence": "SƒÅnsh√≠ fƒìnzh≈çng", "category": "time"},
            {"word": "Áé∞Âú®", "pinyin": "xi√†nz√†i", "meaning": "Now", "sentence": "Xi√†nz√†i j«ê di«én?", "category": "time"},
            {"word": "Êó∂ÂÄô", "pinyin": "sh√≠hou", "meaning": "Time/Moment", "sentence": "Sh√©nme sh√≠hou?", "category": "time"},
            {"word": "‰ªäÂ§©", "pinyin": "jƒ´ntiƒÅn", "meaning": "Today", "sentence": "Jƒ´ntiƒÅn hƒõn r√®", "category": "time"},
            {"word": "ÊòéÂ§©", "pinyin": "m√≠ngtiƒÅn", "meaning": "Tomorrow", "sentence": "M√≠ngtiƒÅn ji√†n", "category": "time"},
            {"word": "Êò®Â§©", "pinyin": "zu√≥tiƒÅn", "meaning": "Yesterday", "sentence": "Zu√≥tiƒÅn w«í m√©i q√π", "category": "time"},
            {"word": "‰∏äÂçà", "pinyin": "sh√†ngw«î", "meaning": "Morning", "sentence": "Sh√†ngw«î h«éo", "category": "time"},
            {"word": "‰∏≠Âçà", "pinyin": "zh≈çngw«î", "meaning": "Noon", "sentence": "Zh≈çngw«î chƒ´ sh√©nme?", "category": "time"},
            {"word": "‰∏ãÂçà", "pinyin": "xi√†w«î", "meaning": "Afternoon", "sentence": "Xi√†w«î sƒÅn di«én", "category": "time"},
            {"word": "Âπ¥", "pinyin": "ni√°n", "meaning": "Year", "sentence": "Jƒ´nni√°n", "category": "time"},
            {"word": "Êúà", "pinyin": "yu√®", "meaning": "Month", "sentence": "Yƒ´ yu√®", "category": "time"},
            {"word": "Êó•", "pinyin": "r√¨", "meaning": "Day/Sun", "sentence": "SƒÅn r√¨", "category": "time"},
            {"word": "ÊòüÊúü", "pinyin": "xƒ´ngqƒ´", "meaning": "Week", "sentence": "Xƒ´ngqƒ´ yƒ´", "category": "time"},
            {"word": "ÊòØ", "pinyin": "sh√¨", "meaning": "To be", "sentence": "W«í sh√¨ xu√©shƒìng", "category": "verb"},
            {"word": "Êúâ", "pinyin": "y«íu", "meaning": "To have", "sentence": "W«í y«íu qi√°n", "category": "verb"},
            {"word": "Áúã", "pinyin": "k√†n", "meaning": "Look/Watch/Read", "sentence": "K√†n sh≈´", "category": "verb"},
            {"word": "Âê¨", "pinyin": "tƒ´ng", "meaning": "Listen", "sentence": "Tƒ´ng yƒ´nyu√®", "category": "verb"},
            {"word": "ËØ¥", "pinyin": "shu≈ç", "meaning": "Speak", "sentence": "Shu≈ç H√†ny«î", "category": "verb"},
            {"word": "ËØª", "pinyin": "d√∫", "meaning": "Read", "sentence": "D√∫ sh≈´", "category": "verb"},
            {"word": "ÂÜô", "pinyin": "xiƒõ", "meaning": "Write", "sentence": "Xiƒõ z√¨", "category": "verb"},
            {"word": "ÁúãËßÅ", "pinyin": "k√†nji√†n", "meaning": "See", "sentence": "W«í k√†nji√†n tƒÅ le", "category": "verb"},
            {"word": "Âè´", "pinyin": "ji√†o", "meaning": "Call/Name", "sentence": "N«ê ji√†o sh√©nme?", "category": "verb"},
            {"word": "Êù•", "pinyin": "l√°i", "meaning": "Come", "sentence": "TƒÅ l√°i le ma?", "category": "verb"},
            {"word": "Âõû", "pinyin": "hu√≠", "meaning": "Return", "sentence": "Hu√≠ jiƒÅ", "category": "verb"},
            {"word": "Âéª", "pinyin": "q√π", "meaning": "Go", "sentence": "Q√π xu√©xi√†o", "category": "verb"},
            {"word": "ÂêÉ", "pinyin": "chƒ´", "meaning": "Eat", "sentence": "Chƒ´ f√†n", "category": "verb"},
            {"word": "Âñù", "pinyin": "hƒì", "meaning": "Drink", "sentence": "Hƒì shu«ê", "category": "verb"},
            {"word": "Áù°Ëßâ", "pinyin": "shu√¨ji√†o", "meaning": "Sleep", "sentence": "W«í y√†o shu√¨ji√†o", "category": "verb"},
            {"word": "ÊâìÁîµËØù", "pinyin": "d«é di√†nhu√†", "meaning": "Call phone", "sentence": "Gƒõi mƒÅma d«é di√†nhu√†", "category": "verb"},
            {"word": "ÂÅö", "pinyin": "zu√≤", "meaning": "Do/Make", "sentence": "Zu√≤ f√†n", "category": "verb"},
            {"word": "‰π∞", "pinyin": "m«éi", "meaning": "Buy", "sentence": "M«éi d≈çngxi", "category": "verb"},
            {"word": "ÂºÄ", "pinyin": "kƒÅi", "meaning": "Open/Drive", "sentence": "KƒÅi chƒì", "category": "verb"},
            {"word": "Âùê", "pinyin": "zu√≤", "meaning": "Sit", "sentence": "Q«êng zu√≤", "category": "verb"},
            {"word": "‰Ωè", "pinyin": "zh√π", "meaning": "Live", "sentence": "N«ê zh√π z√†i n«ér?", "category": "verb"},
            {"word": "Â≠¶‰π†", "pinyin": "xu√©x√≠", "meaning": "Study", "sentence": "Xu√©x√≠ H√†ny«î", "category": "verb"},
            {"word": "Â∑•‰Ωú", "pinyin": "g≈çngzu√≤", "meaning": "Work", "sentence": "W«í z√†i g≈çngzu√≤", "category": "verb"},
            {"word": "‰∏ãÈõ®", "pinyin": "xi√† y«î", "meaning": "Rain", "sentence": "Jƒ´ntiƒÅn xi√† y«î", "category": "verb"},
            {"word": "Áà±", "pinyin": "√†i", "meaning": "Love", "sentence": "W«í √†i n«ê", "category": "verb"},
            {"word": "ÂñúÊ¨¢", "pinyin": "x«êhuan", "meaning": "Like", "sentence": "W«í x«êhuan chƒ´", "category": "verb"},
            {"word": "ÊÉ≥", "pinyin": "xi«éng", "meaning": "Want/Think", "sentence": "W«í xi«éng q√π", "category": "verb"},
            {"word": "ËÆ§ËØÜ", "pinyin": "r√®nshi", "meaning": "Know/Meet", "sentence": "R√®nshi n«ê hƒõn gƒÅox√¨ng", "category": "verb"},
            {"word": "‰ºö", "pinyin": "hu√¨", "meaning": "Can", "sentence": "W«í hu√¨ shu≈ç H√†ny«î", "category": "verb"},
            {"word": "ËÉΩ", "pinyin": "n√©ng", "meaning": "Can/Able to", "sentence": "W«í n√©ng zu√≤", "category": "verb"},
            {"word": "Â•Ω", "pinyin": "h«éo", "meaning": "Good", "sentence": "N«ê h«éo", "category": "adjective"},
            {"word": "Â§ö", "pinyin": "du≈ç", "meaning": "Many", "sentence": "Hƒõn du≈ç", "category": "adjective"},
            {"word": "Â∞ë", "pinyin": "sh«éo", "meaning": "Few", "sentence": "Hƒõn sh«éo", "category": "adjective"},
            {"word": "ÂÜ∑", "pinyin": "lƒõng", "meaning": "Cold", "sentence": "Jƒ´ntiƒÅn hƒõn lƒõng", "category": "adjective"},
            {"word": "ÁÉ≠", "pinyin": "r√®", "meaning": "Hot", "sentence": "TiƒÅnq√¨ hƒõn r√®", "category": "adjective"},
            {"word": "È´òÂÖ¥", "pinyin": "gƒÅox√¨ng", "meaning": "Happy", "sentence": "Hƒõn gƒÅox√¨ng", "category": "adjective"},
            {"word": "ÊºÇ‰∫Æ", "pinyin": "pi√†oliang", "meaning": "Beautiful", "sentence": "TƒÅ hƒõn pi√†oliang", "category": "adjective"},
            {"word": "Â§ß", "pinyin": "d√†", "meaning": "Big", "sentence": "F√°ngzi hƒõn d√†", "category": "adjective"},
            {"word": "Â∞è", "pinyin": "xi«éo", "meaning": "Small", "sentence": "G«íu hƒõn xi«éo", "category": "adjective"},
            {"word": "‰∏ç", "pinyin": "b√π", "meaning": "No/Not", "sentence": "B√π h«éo", "category": "adverb"},
            {"word": "Ê≤°", "pinyin": "m√©i", "meaning": "No (have)", "sentence": "W«í m√©i y«íu", "category": "adverb"},
            {"word": "Âæà", "pinyin": "hƒõn", "meaning": "Very", "sentence": "Hƒõn h«éo", "category": "adverb"},
            {"word": "Â§™", "pinyin": "t√†i", "meaning": "Too", "sentence": "T√†i d√† le", "category": "adverb"},
            {"word": "ÈÉΩ", "pinyin": "d≈çu", "meaning": "All", "sentence": "W«ímen d≈çu q√π", "category": "adverb"},
            {"word": "Âíå", "pinyin": "h√©", "meaning": "And", "sentence": "W«í h√© n«ê", "category": "conjunction"},
            {"word": "Âú®", "pinyin": "z√†i", "meaning": "At/In", "sentence": "Z√†i jiƒÅ", "category": "preposition"},
            {"word": "Èáå", "pinyin": "l«ê", "meaning": "Inside", "sentence": "Xu√©xi√†o l«ê", "category": "position"},
            {"word": "‰∏ä", "pinyin": "sh√†ng", "meaning": "Up/On", "sentence": "Zhu≈çzi sh√†ng", "category": "position"},
            {"word": "‰∏ã", "pinyin": "xi√†", "meaning": "Down", "sentence": "Y«êzi xi√†", "category": "position"},
            {"word": "Ââç", "pinyin": "qi√°n", "meaning": "Front", "sentence": "Qi√°nmi√†n", "category": "position"},
            {"word": "Âêé", "pinyin": "h√≤u", "meaning": "Back", "sentence": "H√≤umi√†n", "category": "position"},
            {"word": "Ëøô", "pinyin": "zh√®", "meaning": "This", "sentence": "Zh√® sh√¨ sh√©nme?", "category": "pronoun"},
            {"word": "ÈÇ£", "pinyin": "n√†", "meaning": "That", "sentence": "N√† sh√¨ sh≈´", "category": "pronoun"},
            {"word": "Âì™", "pinyin": "n«é", "meaning": "Which", "sentence": "N«é ge?", "category": "pronoun"},
            {"word": "Âì™ÂÑø", "pinyin": "n«ér", "meaning": "Where", "sentence": "N«ê z√†i n«ér?", "category": "pronoun"},
            {"word": "Ë∞Å", "pinyin": "sh√©i", "meaning": "Who", "sentence": "TƒÅ sh√¨ sh√©i?", "category": "pronoun"},
            {"word": "‰ªÄ‰πà", "pinyin": "sh√©nme", "meaning": "What", "sentence": "Sh√©nme d≈çngxi?", "category": "pronoun"},
            {"word": "Â§öÂ∞ë", "pinyin": "du≈çshao", "meaning": "How many", "sentence": "Du≈çsh«éo qi√°n?", "category": "pronoun"},
            {"word": "Âá†", "pinyin": "j«ê", "meaning": "How many", "sentence": "J«ê ge r√©n?", "category": "pronoun"},
            {"word": "ÊÄé‰πà", "pinyin": "zƒõnme", "meaning": "How", "sentence": "Zƒõnme q√π?", "category": "pronoun"},
            {"word": "ÊÄé‰πàÊ†∑", "pinyin": "zƒõnmey√†ng", "meaning": "How about", "sentence": "TiƒÅnq√¨ zƒõnmey√†ng?", "category": "pronoun"},
            {"word": "ÁöÑ", "pinyin": "de", "meaning": "Of", "sentence": "W«í de sh≈´", "category": "particle"},
            {"word": "‰∫Ü", "pinyin": "le", "meaning": "Past part", "sentence": "TƒÅ l√°i le", "category": "particle"},
            {"word": "Âêó", "pinyin": "ma", "meaning": "Question", "sentence": "H«éo ma?", "category": "particle"},
            {"word": "Âë¢", "pinyin": "ne", "meaning": "Question", "sentence": "N«ê ne?", "category": "particle"},
            {"word": "ÂñÇ", "pinyin": "w√®i", "meaning": "Hello", "sentence": "W√®i, n«ê h«éo", "category": "interjection"},
            {"word": "Ë∞¢Ë∞¢", "pinyin": "xi√®xie", "meaning": "Thanks", "sentence": "Xi√®xie n«ê", "category": "phrase"},
            {"word": "‰∏çÂÆ¢Ê∞î", "pinyin": "b√∫ k√®qi", "meaning": "Welcome", "sentence": "B√∫ k√®qi", "category": "phrase"},
            {"word": "ÂÜçËßÅ", "pinyin": "z√†iji√†n", "meaning": "Goodbye", "sentence": "M√≠ngtiƒÅn ji√†n", "category": "phrase"},
            {"word": "ÂØπ‰∏çËµ∑", "pinyin": "du√¨buq«ê", "meaning": "Sorry", "sentence": "Du√¨buq«ê", "category": "phrase"},
            {"word": "Ê≤°ÂÖ≥Á≥ª", "pinyin": "m√©i guƒÅnxi", "meaning": "No problem", "sentence": "M√©i guƒÅnxi", "category": "phrase"},
            {"word": "‰∏™", "pinyin": "g√®", "meaning": "Measure", "sentence": "Yƒ´ ge r√©n", "category": "measure"},
            {"word": "Êú¨", "pinyin": "bƒõn", "meaning": "Measure", "sentence": "Yƒ´ bƒõn sh≈´", "category": "measure"},
            {"word": "‰∫õ", "pinyin": "xiƒì", "meaning": "Some", "sentence": "Zh√®xiƒì", "category": "measure"},
            {"word": "Âùó", "pinyin": "ku√†i", "meaning": "Piece/Yuan", "sentence": "Yƒ´ ku√†i qi√°n", "category": "measure"},
            {"word": "Â≤Å", "pinyin": "su√¨", "meaning": "Years old", "sentence": "W«í bƒÅ su√¨", "category": "measure"}
        ];

        const qa_pairs = [
            {"q": "N«ê ji√†o sh√©nme?", "a": "W«í ji√†o David"},
            {"q": "Xi√®xie!", "a": "B√∫ k√®qi"},
            {"q": "Z√†iji√†n!", "a": "M√≠ngtiƒÅn ji√†n"},
            {"q": "Du≈çsh«éo qi√°n?", "a": "W«î ku√†i"},
            {"q": "N«ê q√π n«ér?", "a": "Hu√≠ jiƒÅ"},
            {"q": "Jƒ´ntiƒÅn j«ê h√†o?", "a": "BƒÅ h√†o"},
            {"q": "TƒÅ sh√¨ sh√©i?", "a": "W«í l«éoshƒ´"},
            {"q": "N«ê h«éo ma?", "a": "W«í hƒõn h«éo"},
            {"q": "Xi√†nz√†i j«ê di«én?", "a": "SƒÅn di«én"},
            {"q": "N«ê chƒ´ f√†n ma?", "a": "W«í b√π chƒ´"}
        ];

        // 2. HELPER FUNCTIONS
        function getImg(text) {
            // T·ª± ƒë·ªông t√¨m ·∫£nh theo t√™n: "Train Station" -> "images/train-station.jpg"
            const filename = text.toLowerCase().replace(/[^a-z0-9]/g, '-').replace(/-+/g, '-');
            return `images/${filename}.jpg`;
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function getDistractors(target, count) {
            const pool = hsk1_vocab.filter(x => x !== target);
            return shuffle(pool).slice(0, count);
        }

        function getRandomItem() {
            return hsk1_vocab[Math.floor(Math.random() * hsk1_vocab.length)];
        }

        // 3. EXAM GENERATOR
        let examData = [];
        let globalId = 1;

        function addQ(type, section, content, audio, img, opts, correct, optType='text', isExample=false) {
            examData.push({
                id: globalId,
                isExample, type, section, content, audioText: audio, image: img,
                options: opts, optionType: optType, correct
            });
            if (!isExample) globalId++;
        }

        function generateExam() {
            examData = [];
            globalId = 1;

            // --- LISTENING ---
            // Part 1: ƒê√∫ng/Sai (Example + 5)
            addQ("listening", "Nghe P1: ƒê√∫ng/Sai", "W«í hƒõn gƒÅox√¨ng (Vui v·∫ª)", "W«í hƒõn gƒÅox√¨ng", getImg("Happy"), ["ƒê√∫ng", "Sai"], 0, "text", true);
            for(let i=0; i<5; i++) {
                const item = getRandomItem();
                const isTrue = Math.random() < 0.5;
                const display = isTrue ? item : getRandomItem();
                addQ("listening", "Nghe P1: ƒê√∫ng/Sai", `${item.word} (${item.meaning})`, item.word, getImg(display.meaning), ["ƒê√∫ng", "Sai"], isTrue ? 0 : 1);
            }

            // Part 2: Ch·ªçn H√¨nh (Example + 5)
            addQ("listening", "Nghe P2: Ch·ªçn h√¨nh", "Nghe v√† ch·ªçn h√¨nh:", "Zh√® sh√¨ sh≈´", null, [getImg("Book"), getImg("Dog"), getImg("Car")], 0, "image", true);
            for(let i=0; i<5; i++) {
                const target = getRandomItem();
                const dist = getDistractors(target, 2);
                let opts = [target, ...dist];
                opts = shuffle(opts);
                const imgOpts = opts.map(x => getImg(x.meaning));
                addQ("listening", "Nghe P2: Ch·ªçn h√¨nh", "Nghe c√¢u v√† ch·ªçn h√¨nh:", target.sentence, null, imgOpts, opts.indexOf(target), "image");
            }

            // Part 3: H·ªôi tho·∫°i (Example + 5)
            addQ("listening", "Nghe P3: H·ªôi tho·∫°i", "Nghe h·ªôi tho·∫°i ch·ªçn h√¨nh:", "A: N«ê h«éo! B: N«ê h«éo!", null, [getImg("Hello"), getImg("Bye"), getImg("Eat")], 0, "image", true);
            for(let i=0; i<5; i++) {
                const target = getRandomItem();
                const dist = getDistractors(target, 2);
                let opts = [target, ...dist];
                opts = shuffle(opts);
                const imgOpts = opts.map(x => getImg(x.meaning));
                addQ("listening", "Nghe P3: H·ªôi tho·∫°i", "Nghe h·ªôi tho·∫°i v√† ch·ªçn h√¨nh:", `A: N«ê x«êhuan ${target.pinyin} ma? \n B: Hƒõn x«êhuan!`, null, imgOpts, opts.indexOf(target), "image");
            }

            // Part 4: Ch·ªçn Text (Example + 5)
            addQ("listening", "Nghe P4: Ch·ªçn ƒë√°p √°n", "Ch·ªçn c√¢u tr·∫£ l·ªùi:", "TƒÅ z√†i n«ér?", null, ["Z√†i jiƒÅ", "Chƒ´ f√†n", "Xu√©xi√†o"], 0, "text", true);
            for(let i=0; i<5; i++) {
                const target = getRandomItem();
                const dist = getDistractors(target, 2);
                let opts = [target.word, dist[0].word, dist[1].word];
                opts = shuffle(opts);
                addQ("listening", "Nghe P4: Ch·ªçn ƒë√°p √°n", `Zh√® sh√¨ sh√©nme? - ${target.meaning}`, null, null, opts, opts.indexOf(target.word), "text");
            }

            // --- READING ---
            // Part 1: ƒê√∫ng/Sai
            addQ("reading", "ƒê·ªçc P1: ƒê√∫ng/Sai", "Di√†nn«éo (M√°y t√≠nh)", null, getImg("Computer"), ["ƒê√∫ng", "Sai"], 0, "text", true);
            for(let i=0; i<5; i++) {
                const item = getRandomItem();
                const isTrue = Math.random() < 0.5;
                const display = isTrue ? item : getRandomItem();
                addQ("reading", "ƒê·ªçc P1: ƒê√∫ng/Sai", `${item.word} (${item.pinyin})`, null, getImg(display.meaning), ["ƒê√∫ng", "Sai"], isTrue ? 0 : 1);
            }

            // Part 2: Ch·ªçn H√¨nh
            addQ("reading", "ƒê·ªçc P2: Ch·ªçn h√¨nh", "W«í hƒì ch√°.", null, null, [getImg("Tea"), getImg("Rice"), getImg("Water")], 0, "image", true);
            for(let i=0; i<5; i++) {
                const target = getRandomItem();
                const dist = getDistractors(target, 2);
                let opts = [target, ...dist];
                opts = shuffle(opts);
                const imgOpts = opts.map(x => getImg(x.meaning));
                addQ("reading", "ƒê·ªçc P2: Ch·ªçn h√¨nh", target.sentence, null, null, imgOpts, opts.indexOf(target), "image");
            }

            // Part 3: H·ªèi ƒê√°p
            addQ("reading", "ƒê·ªçc P3: H·ªèi ƒê√°p", "N«ê h«éo ma?", null, null, ["Hƒõn h«éo", "Xi√®xie", "Du√¨buq«ê"], 0, "text", true);
            const pairs = shuffle([...qa_pairs]).slice(0, 5);
            for(let p of pairs) {
                const target = p.a;
                const others = qa_pairs.filter(x => x.a !== target).map(x => x.a);
                const dist = shuffle(others).slice(0, 2);
                let opts = shuffle([target, ...dist]);
                addQ("reading", "ƒê·ªçc P3: H·ªèi ƒê√°p", p.q, null, null, opts, opts.indexOf(target));
            }

            // Part 4: ƒêi·ªÅn t·ª´
            addQ("reading", "ƒê·ªçc P4: ƒêi·ªÅn t·ª´", "W«í ___ xu√©shƒìng (T√¥i l√† HS).", null, null, ["sh√¨", "b√π", "h«éo"], 0, "text", true);
            for(let i=0; i<5; i++) {
                const target = getRandomItem();
                const dist = getDistractors(target, 2);
                let opts = shuffle([target.word, dist[0].word, dist[1].word]);
                addQ("reading", "ƒê·ªçc P4: ƒêi·ªÅn t·ª´", `W«í ___ ${target.word}.`, null, null, opts, opts.indexOf(target.word));
            }
        }

        // 4. VIEW LOGIC
        let currentIdx = 0;
        let userAnswers = [];
        let timerInterval;
        let timeLeft = 40 * 60;

        // Init Exam Data on Load
        generateExam();
        userAnswers = new Array(examData.length).fill(null);

        function startExam() {
            document.getElementById('start-screen').style.display = 'none';
            renderSidebar();
            loadQuestion(0);
            
            timerInterval = setInterval(() => {
                timeLeft--;
                const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
                const s = (timeLeft % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${m}:${s}`;
                if (timeLeft <= 0) { clearInterval(timerInterval); submitTest(); }
            }, 1000);
        }

        function renderSidebar() {
            const listGrid = document.getElementById('grid-listening');
            const readGrid = document.getElementById('grid-reading');
            listGrid.innerHTML = ""; readGrid.innerHTML = "";

            examData.forEach((q, idx) => {
                if (q.isExample) return;
                const div = document.createElement('div');
                div.className = 'q-dot';
                div.innerText = q.id;
                div.id = `dot-${idx}`;
                div.onclick = () => loadQuestion(idx);
                if (q.type === 'listening') listGrid.appendChild(div);
                else readGrid.appendChild(div);
            });
        }

        function loadQuestion(idx) {
            currentIdx = idx;
            const q = examData[idx];
            const card = document.getElementById('q-card');
            const exTag = document.getElementById('example-tag');
            
            if (q.isExample) {
                card.classList.add('example-mode');
                exTag.style.display = 'inline-flex';
            } else {
                card.classList.remove('example-mode');
                exTag.style.display = 'none';
                document.querySelectorAll('.q-dot').forEach(d => d.classList.remove('active'));
                const dot = document.getElementById(`dot-${idx}`);
                if (dot) dot.classList.add('active');
            }

            document.getElementById('section-badge').innerText = q.section;
            document.getElementById('audio-control').style.display = q.type === 'listening' ? 'flex' : 'none';

            let html = `<div class="q-text">${q.content}</div>`;
            if (q.image) {
                // FALLBACK IMAGE: N·∫øu kh√¥ng c√≥ ·∫£nh th·∫≠t -> D√πng ·∫£nh Placeholder
                const placeholder = `https://placehold.co/400x300/2C3E50/FFF?text=${q.content.split(' ')[0]}`;
                html += `<div class="q-image-container">
                            <img src="${q.image}" onerror="this.onerror=null;this.src='${placeholder}'">
                         </div>`;
            }
            document.getElementById('question-content').innerHTML = html;

            const container = document.getElementById('options-container');
            container.innerHTML = "";
            const letters = ['A', 'B', 'C', 'D'];

            if (q.optionType === 'image') {
                container.className = "options-grid image-mode";
                q.options.forEach((optImg, i) => {
                    const div = document.createElement('div');
                    div.className = `option-image-card ${userAnswers[idx] === i ? 'selected' : ''}`;
                    
                    const placeholder = `https://placehold.co/400x300/eee/999?text=IMG-${i+1}`;
                    div.innerHTML = `<img src="${optImg}" onerror="this.onerror=null;this.src='${placeholder}'">
                                     <div class="img-key">${letters[i]}</div>`;
                    
                    div.onclick = () => selectAnswer(idx, i);
                    container.appendChild(div);
                });
            } else {
                container.className = "options-grid";
                q.options.forEach((optText, i) => {
                    const div = document.createElement('div');
                    div.className = `option-btn ${userAnswers[idx] === i ? 'selected' : ''}`;
                    let key = letters[i];
                    if (q.options.length === 2) key = (i === 0) ? '‚úî' : '‚úò';
                    div.innerHTML = `<div class="option-key">${key}</div><div>${optText}</div>`;
                    div.onclick = () => selectAnswer(idx, i);
                    container.appendChild(div);
                });
            }
        }

        function selectAnswer(qIdx, ansIdx) {
            if (examData[qIdx].isExample) return;
            userAnswers[qIdx] = ansIdx;
            loadQuestion(qIdx);
            const dot = document.getElementById(`dot-${qIdx}`);
            if(dot) dot.classList.add('answered');
        }

        function nextQuestion() { if (currentIdx < examData.length - 1) loadQuestion(currentIdx + 1); }
        function prevQuestion() { if (currentIdx > 0) loadQuestion(currentIdx - 1); }
        
        function playAudio() {
            if (!examData[currentIdx].audioText) return;
            const u = new SpeechSynthesisUtterance(examData[currentIdx].audioText);
            u.lang = 'zh-CN'; u.rate = 0.8;
            window.speechSynthesis.speak(u);
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
            const closeBtn = document.getElementById('close-sidebar');
            closeBtn.style.display = closeBtn.style.display === 'block' ? 'none' : 'block';
        }

        function submitTest() {
            if(!confirm("N·ªôp b√†i ngay?")) return;
            clearInterval(timerInterval);
            let correctCount = 0;
            let realQuestions = 0;
            examData.forEach((q, idx) => {
                if (!q.isExample) {
                    realQuestions++;
                    if (userAnswers[idx] === q.correct) correctCount++;
                }
            });
            const score = Math.round((correctCount / realQuestions) * 200);
            document.getElementById('resultModal').style.display = 'flex';
            document.getElementById('final-score').innerText = score;
            const msg = document.getElementById('pass-msg');
            if (score >= 120) {
                msg.innerText = "üéâ ƒê·∫¨U R·ªíI! (PASS)";
                msg.style.color = "var(--success)";
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            } else {
                msg.innerText = "C·∫¶N C·ªê G·∫ÆNG H∆†N (FAIL)";
                msg.style.color = "var(--accent)";
            }
            if(window.saveTestResult) window.saveTestResult(score, 200);
        }
    </script>
</body>
</html>