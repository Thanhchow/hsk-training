<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thi th·ª≠ HSK 1 - HSK Plus</title>
    
    <link rel="icon" type="image/png" href="favicon-32x32.png">
    <meta name="theme-color" content="#ffffff">

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #2C3E50; --accent: #FF4757; --bg: #F0F2F5; --white: #fff; --success: #2ED573; --warning: #FFA502; }
        body { font-family: 'Montserrat', 'Noto Sans SC', sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; color: #333; }

        /* HEADER */
        .header { background: var(--white); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); z-index: 10; }
        .logo { font-weight: 700; font-size: 1.1rem; display: flex; align-items: center; gap: 10px; cursor: pointer; color: var(--primary); }
        .logo:hover { color: var(--accent); }
        
        .timer-box { 
            background: var(--primary); color: white; padding: 8px 15px; border-radius: 50px; 
            font-variant-numeric: tabular-nums; font-weight: bold; font-size: 1rem; 
            box-shadow: 0 4px 10px rgba(44, 62, 80, 0.2); display: flex; align-items: center; gap: 5px;
        }
        
        /* LAYOUT */
        .main-container { display: flex; flex: 1; overflow: hidden; }
        
        /* C·ªòT TR√ÅI: N·ªòI DUNG C√ÇU H·ªéI */
        .question-area { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; align-items: center; position: relative; }
        .question-card { background: white; width: 100%; max-width: 700px; border-radius: 15px; padding: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); border-top: 5px solid var(--accent); }
        
        .section-badge { display: inline-block; background: #FFEBEE; color: var(--accent); padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 700; margin-bottom: 15px; }
        .q-text { font-size: 1.3rem; font-weight: 600; margin-bottom: 15px; line-height: 1.4; color: var(--primary); }
        
        /* H√åNH ·∫¢NH */
        .q-image-container { text-align: center; margin: 15px 0; }
        .q-image { max-width: 100%; height: auto; max-height: 250px; border-radius: 8px; border: 2px solid #eee; }

        /* AUDIO PLAYER */
        .audio-control { 
            background: #f8f9fa; padding: 15px; border-radius: 12px; display: flex; align-items: center; gap: 15px; 
            cursor: pointer; transition: 0.2s; border: 1px solid #eee; margin-bottom: 20px; width: fit-content;
        }
        .audio-control:hover { background: #eef2f5; border-color: #cbd5e0; }
        .audio-icon { font-size: 1.5rem; }
        .audio-label { font-size: 0.9rem; font-weight: 600; color: #555; }

        /* ƒê√ÅP √ÅN */
        .options-grid { display: grid; gap: 12px; margin-top: 20px; }
        .option-btn { 
            padding: 15px 20px; border: 2px solid #f0f0f0; border-radius: 10px; background: white; 
            cursor: pointer; text-align: left; transition: 0.2s; font-size: 1rem; display: flex; align-items: center; gap: 10px;
        }
        .option-btn:hover { border-color: var(--primary); background: #f8fbff; }
        .option-btn.selected { border-color: var(--accent); background: #FFF0F0; color: var(--accent); font-weight: 700; }
        .option-key { width: 25px; height: 25px; border-radius: 50%; background: #eee; display: flex; justify-content: center; align-items: center; font-size: 0.8rem; color: #666; }
        .option-btn.selected .option-key { background: var(--accent); color: white; }

        /* C·ªòT PH·∫¢I: ƒêI·ªÄU H∆Ø·ªöNG */
        .sidebar { width: 280px; background: white; border-left: 1px solid #eee; display: flex; flex-direction: column; z-index: 5; }
        .sidebar-header { padding: 15px; border-bottom: 1px solid #eee; font-weight: 700; color: var(--primary); text-align: center; }
        
        .grid-scroll { flex: 1; overflow-y: auto; padding: 15px; }
        .q-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
        .q-dot { 
            aspect-ratio: 1; border-radius: 8px; background: #f5f5f5; color: #666; font-size: 0.85rem; font-weight: 600;
            display: flex; justify-content: center; align-items: center; cursor: pointer; transition: 0.2s; border: 1px solid transparent;
        }
        .q-dot:hover { background: #e0e0e0; }
        .q-dot.active { border-color: var(--accent); color: var(--accent); background: #fff; box-shadow: 0 0 0 2px rgba(255, 71, 87, 0.2); }
        .q-dot.answered { background: var(--primary); color: white; }

        /* NAVIGATION BUTTONS */
        .nav-buttons { display: flex; justify-content: space-between; margin-top: 20px; max-width: 700px; width: 100%; }
        .nav-btn { padding: 10px 25px; border-radius: 50px; border: none; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .btn-prev { background: #eee; color: #555; }
        .btn-prev:hover { background: #ddd; }
        .btn-next { background: var(--primary); color: white; }
        .btn-next:hover { background: #1a252f; }

        .submit-area { padding: 20px; border-top: 1px solid #eee; }
        .submit-btn { width: 100%; background: var(--accent); color: white; padding: 12px; border-radius: 50px; font-weight: bold; border: none; cursor: pointer; font-size: 1rem; box-shadow: 0 4px 10px rgba(255, 71, 87, 0.3); }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(255, 71, 87, 0.4); }

        /* MODAL */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-content { background: white; padding: 40px; border-radius: 20px; text-align: center; max-width: 400px; width: 90%; animation: slideUp 0.3s ease; }
        .score-display { font-size: 3rem; font-weight: 800; color: var(--accent); margin: 10px 0; }
        
        @keyframes slideUp { from {transform: translateY(20px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .sidebar { display: none; position: fixed; top: 0; right: 0; height: 100%; box-shadow: -5px 0 15px rgba(0,0,0,0.1); }
            .sidebar.open { display: flex; }
            .header { font-size: 0.9rem; }
            .mobile-menu-btn { display: block; font-size: 1.5rem; cursor: pointer; }
        }
        @media (min-width: 769px) { .mobile-menu-btn { display: none; } }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo" onclick="window.location.href='index.html'">
            <span>‚¨Ö Quay l·∫°i</span>
        </div>
        <div class="timer-box">
            <span>‚è±</span> <span id="timer">40:00</span>
        </div>
        <div class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</div>
    </div>

    <div class="main-container">
        <div class="question-area">
            <div class="question-card">
                <div class="section-badge" id="section-badge">Ph·∫ßn 1</div>
                
                <div class="audio-control" id="audio-control" onclick="playAudio()">
                    <span class="audio-icon">üîä</span>
                    <div class="audio-label" id="audio-text">B·∫•m v√†o ƒë√¢y ƒë·ªÉ nghe</div>
                </div>

                <div id="question-content"></div>

                <div class="options-grid" id="options-container"></div>
            </div>

            <div class="nav-buttons">
                <button class="nav-btn btn-prev" onclick="prevQuestion()">C√¢u tr∆∞·ªõc</button>
                <button class="nav-btn btn-next" onclick="nextQuestion()">C√¢u ti·∫øp theo</button>
            </div>
        </div>

        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                B·∫£ng C√¢u H·ªèi (40)
                <span style="float:right; cursor:pointer; font-size:1.2rem" class="mobile-menu-btn" onclick="toggleSidebar()">√ó</span>
            </div>
            <div class="grid-scroll">
                <div style="margin-bottom:10px; font-weight:bold; font-size:0.8rem; color:#999;">PH·∫¶N NGHE (1-20)</div>
                <div class="q-grid" id="grid-listening"></div>
                
                <div style="margin-top:20px; margin-bottom:10px; font-weight:bold; font-size:0.8rem; color:#999;">PH·∫¶N ƒê·ªåC (21-40)</div>
                <div class="q-grid" id="grid-reading"></div>
            </div>
            <div class="submit-area">
                <button class="submit-btn" onclick="submitTest()">N·ªòP B√ÄI</button>
            </div>
        </div>
    </div>

    <div id="resultModal" class="modal">
        <div class="modal-content">
            <h2 style="margin:0; color:var(--primary)">K·∫øt Qu·∫£ Thi</h2>
            <div style="font-size:0.9rem; color:#666; margin-top:5px">HSK 1 - Mock Test</div>
            
            <div class="score-display" id="final-score">0</div>
            <div style="font-weight:bold; color:#555">/ 200 ƒêi·ªÉm</div>
            
            <p id="pass-msg" style="font-weight:600; margin: 20px 0;"></p>
            
            <button class="submit-btn" onclick="window.location.href='index.html'">V·ªÅ trang ch·ªß</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
        import { getFirestore, doc, updateDoc, arrayUnion, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBgc-OYf_lq9bTu_lQv46XbYtnEp4SBynY",
            authDomain: "hsk-plus-web.firebaseapp.com",
            projectId: "hsk-plus-web",
            storageBucket: "hsk-plus-web.firebasestorage.app",
            messagingSenderId: "757004452643",
            appId: "1:757004452643:web:cbef488f9d7699ac034296",
            measurementId: "G-8XVEFW19DQ"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let currentUser = null;

        onAuthStateChanged(auth, (user) => {
            if (user) currentUser = user;
            else { alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ l∆∞u k·∫øt qu·∫£!"); window.location.href = 'index.html'; }
        });

        window.saveTestResult = async function(score) {
            if (!currentUser) return;
            const userRef = doc(db, "users", currentUser.uid);
            const resultData = {
                testName: "HSK 1 Mock Test",
                score: score,
                total: 200,
                date: new Date().toISOString(),
                pass: score >= 120
            };
            try {
                const docSnap = await getDoc(userRef);
                if (!docSnap.exists()) await setDoc(userRef, { testHistory: [resultData] });
                else await updateDoc(userRef, { testHistory: arrayUnion(resultData) });
            } catch (e) { console.error(e); }
        }
    </script>

    <script>
        // --- D·ªÆ LI·ªÜU ƒê·ªÄ THI 40 C√ÇU (CHU·∫®N C·∫§U TR√öC HSK 1) ---
        // L∆∞u √Ω: ·∫¢nh ƒëang d√πng Placeholder (·∫¢nh gi·ªØ ch·ªó). B·∫°n h√£y thay b·∫±ng link ·∫£nh th·∫≠t.
        
        const examData = [
		{
        "id": 1,
        "type": "listening",
        "section": "Nghe - Ph·∫ßn 1: ƒê√∫ng hay Sai?",
        "audioText": "Êó•",
        "content": "Êó• (Day/Sun)",
        "image": "https://placehold.co/600x400/2C3E50/FFF?text=Day/Sun",
        "options": [
            "ƒê√∫ng (True)",
            "Sai (False)"
        ],
        "correct": 0
    },
    {
        "id": 2,
        "type": "listening",
        "section": "Nghe - Ph·∫ßn 1: ƒê√∫ng hay Sai?",
        "audioText": "Êàë‰ª¨",
        "content": "Êàë‰ª¨ (We/Us)",
        "image": "https://placehold.co/600x400/2C3E50/FFF?text=How+many/much",
        "options": [
            "ƒê√∫ng (True)",
            "Sai (False)"
        ],
        "correct": 1
    },
    {
        "id": 3,
        "type": "listening",
        "section": "Nghe - Ph·∫ßn 1: ƒê√∫ng hay Sai?",
        "audioText": "Â∞ë",
        "content": "Â∞ë (Few/Little)",
        "image": "https://placehold.co/600x400/2C3E50/FFF?text=No/Not",
        "options": [
            "ƒê√∫ng (True)",
            "Sai (False)"
        ],
        "correct": 1
    },
    {
        "id": 4,
        "type": "listening",
        "section": "Nghe - Ph·∫ßn 1: ƒê√∫ng hay Sai?",
        "audioText": "‰∫∫",
        "content": "‰∫∫ (Person)",
        "image": "https://placehold.co/600x400/2C3E50/FFF?text=Person",
        "options": [
            "ƒê√∫ng (True)",
            "Sai (False)"
        ],
        "correct": 0
    },
    {
        "id": 5,
        "type": "listening",
        "section": "Nghe - Ph·∫ßn 1: ƒê√∫ng hay Sai?",
        "audioText": "Áãó",
        "content": "Áãó (Dog)",
        "image": "https://placehold.co/600x400/2C3E50/FFF?text=Know/Meet",
        "options": [
            "ƒê√∫ng (True)",
            "Sai (False)"
        ],
        "correct": 1
    },
    {
        "id": 6,
        "type": "listening",
        "section": "Nghe - Ph·∫ßn 2: Ch·ªçn h√¨nh ƒë√∫ng",
        "audioText": "W«í hu√¨ shu≈ç H√†ny«î (T√¥i bi·∫øt n√≥i ti·∫øng Trung)",
        "content": "Nghe c√¢u v√† ch·ªçn h√¨nh t∆∞∆°ng ·ª©ng:",
        "options": [
            "[Dad]",
            "[Can]",
            "[Book]"
        ],
        "correct": 1
    },
    {
        "id": 7,
        "type": "listening",
        "section": "Nghe - Ph·∫ßn 2: Ch·ªçn h√¨nh ƒë√∫ng",
        "audioText": "W«í q√π xu√©xi√†o (T√¥i ƒë·∫øn tr∆∞·ªùng)",
        "content": "Nghe c√¢u v√† ch·ªçn h√¨nh t∆∞∆°ng ·ª©ng:",
        "options": [
            "[Student]",
            "[School]",
            "[Beautiful]"
        ],
        "correct": 1
    },
    {
        "id": 8,
        "type": "listening",
        "section": "Nghe - Ph·∫ßn 2: Ch·ªçn h√¨nh ƒë√∫ng",
        "audioText": "TƒÅ hƒõn pi√†oliang (C√¥ ·∫•y r·∫•t ƒë·∫πp)",
        "content": "Nghe c√¢u v√† ch·ªçn h√¨nh t∆∞∆°ng ·ª©ng:",
        "options": [
            "[Beautiful]",
            "[Beijing]",
            "[This]"
        ],
        "correct": 0
    },
    {
        "id": 9,
        "type": "listening",
        "section": "Nghe - Ph·∫ßn 2: Ch·ªçn h√¨nh ƒë√∫ng",
        "audioText": "W«í ji√†o ch≈´z≈´chƒì (T√¥i g·ªçi taxi)",
        "content": "Nghe c√¢u v√† ch·ªçn h√¨nh t∆∞∆°ng ·ª©ng:",
        "options": [
            "[Taxi]",
            "[Work]",
            "[Buy]"
        ],
        "correct": 0
    },
    {
        "id": 10,
        "type": "listening",
        "section": "Nghe - Ph·∫ßn 2: Ch·ªçn h√¨nh ƒë√∫ng",
        "audioText": "Y«êzi xi√† (D∆∞·ªõi gh·∫ø)",
        "content": "Nghe c√¢u v√† ch·ªçn h√¨nh t∆∞∆°ng ·ª©ng:",
        "options": [
            "[See (result)]",
            "[He/Him]",
            "[Down/Under]"
        ],
        "correct": 2
    },
    {
        "id": 11,
        "type": "listening",
        "section": "Nghe - Ph·∫ßn 3: H·ªôi tho·∫°i",
        "audioText": "A: N«ê x«êhuan di«én ma? B: Hƒõn x«êhuan!",
        "content": "Nghe h·ªôi tho·∫°i v√† ch·ªçn h√¨nh:",
        "options": [
            "[I/Me]",
            "[O'clock/Dot]",
            "[Come]"
        ],
        "correct": 1
    },
    {
        "id": 12,
        "type": "listening",
        "section": "Nghe - Ph·∫ßn 3: H·ªôi tho·∫°i",
        "audioText": "A: N«ê x«êhuan kƒÅi ma? B: Hƒõn x«êhuan!",
        "content": "Nghe h·ªôi tho·∫°i v√† ch·ªçn h√¨nh:",
        "options": [
            "[No (past/have)]",
            "[Where]",
            "[Open/Drive]"
        ],
        "correct": 2
    },
    {
        "id": 13,
        "type": "listening",
        "section": "Nghe - Ph·∫ßn 3: H·ªôi tho·∫°i",
        "audioText": "A: N«ê x«êhuan p√©ngyou ma? B: Hƒõn x«êhuan!",
        "content": "Nghe h·ªôi tho·∫°i v√† ch·ªçn h√¨nh:",
        "options": [
            "[Computer]",
            "[Friend]",
            "[Read]"
        ],
        "correct": 1
    },
    {
        "id": 14,
        "type": "listening",
        "section": "Nghe - Ph·∫ßn 3: H·ªôi tho·∫°i",
        "audioText": "A: N«ê x«êhuan zu√≤ ma? B: Hƒõn x«êhuan!",
        "content": "Nghe h·ªôi tho·∫°i v√† ch·ªçn h√¨nh:",
        "options": [
            "[Sit]",
            "[Very]",
            "[To be (is/am/are)]"
        ],
        "correct": 0
    },
    {
        "id": 15,
        "type": "listening",
        "section": "Nghe - Ph·∫ßn 3: H·ªôi tho·∫°i",
        "audioText": "A: N«ê x«êhuan d≈çngxi ma? B: Hƒõn x«êhuan!",
        "content": "Nghe h·ªôi tho·∫°i v√† ch·ªçn h√¨nh:",
        "options": [
            "[Three]",
            "[Do/Make]",
            "[Thing]"
        ],
        "correct": 2
    },
    {
        "id": 16,
        "type": "listening",
        "section": "Nghe - Ph·∫ßn 4: Tr·∫£ l·ªùi c√¢u h·ªèi",
        "audioText": "Zh√® sh√¨ sh√©nme? (ƒê√¢y l√† g√¨?) - Daughter",
        "content": "Ch·ªçn c√¢u tr·∫£ l·ªùi ƒë√∫ng:",
        "options": [
            "Â•≥ÂÑø",
            "Ê§ÖÂ≠ê",
            "Áãó"
        ],
        "correct": 0
    },
    {
        "id": 17,
        "type": "listening",
        "section": "Nghe - Ph·∫ßn 4: Tr·∫£ l·ªùi c√¢u h·ªèi",
        "audioText": "Zh√® sh√¨ sh√©nme? (ƒê√¢y l√† g√¨?) - Now",
        "content": "Ch·ªçn c√¢u tr·∫£ l·ªùi ƒë√∫ng:",
        "options": [
            "Âë¢",
            "ÂàÜÈíü",
            "Áé∞Âú®"
        ],
        "correct": 2
    },
    {
        "id": 18,
        "type": "listening",
        "section": "Nghe - Ph·∫ßn 4: Tr·∫£ l·ªùi c√¢u h·ªèi",
        "audioText": "Zh√® sh√¨ sh√©nme? (ƒê√¢y l√† g√¨?) - Month",
        "content": "Ch·ªçn c√¢u tr·∫£ l·ªùi ƒë√∫ng:",
        "options": [
            "Ê°åÂ≠ê",
            "Êúà",
            "ÊÄé‰πàÊ†∑"
        ],
        "correct": 1
    },
    {
        "id": 19,
        "type": "listening",
        "section": "Nghe - Ph·∫ßn 4: Tr·∫£ l·ªùi c√¢u h·ªèi",
        "audioText": "Zh√® sh√¨ sh√©nme? (ƒê√¢y l√† g√¨?) - Computer",
        "content": "Ch·ªçn c√¢u tr·∫£ l·ªùi ƒë√∫ng:",
        "options": [
            "Ê§ÖÂ≠ê",
            "ÁîµËÑë",
            "Â§™"
        ],
        "correct": 1
    },
    {
        "id": 20,
        "type": "listening",
        "section": "Nghe - Ph·∫ßn 4: Tr·∫£ l·ªùi c√¢u h·ªèi",
        "audioText": "Zh√® sh√¨ sh√©nme? (ƒê√¢y l√† g√¨?) - How",
        "content": "Ch·ªçn c√¢u tr·∫£ l·ªùi ƒë√∫ng:",
        "options": [
            "ÊÄé‰πà",
            "Âåó‰∫¨",
            "‰Ωè"
        ],
        "correct": 0
    },
    {
        "id": 21,
        "type": "reading",
        "section": "ƒê·ªçc - Ph·∫ßn 1: ƒê√∫ng hay Sai?",
        "content": "Âõû (hu√≠)",
        "image": "https://placehold.co/600x400/2C3E50/FFF?text=Return",
        "options": [
            "ƒê√∫ng",
            "Sai"
        ],
        "correct": 0
    },
    {
        "id": 22,
        "type": "reading",
        "section": "ƒê·ªçc - Ph·∫ßn 1: ƒê√∫ng hay Sai?",
        "content": "Ââç (qi√°n)",
        "image": "https://placehold.co/600x400/2C3E50/FFF?text=Some",
        "options": [
            "ƒê√∫ng",
            "Sai"
        ],
        "correct": 1
    },
    {
        "id": 23,
        "type": "reading",
        "section": "ƒê·ªçc - Ph·∫ßn 1: ƒê√∫ng hay Sai?",
        "content": "Áà∏Áà∏ (b√†ba)",
        "image": "https://placehold.co/600x400/2C3E50/FFF?text=Dad",
        "options": [
            "ƒê√∫ng",
            "Sai"
        ],
        "correct": 0
    },
    {
        "id": 24,
        "type": "reading",
        "section": "ƒê·ªçc - Ph·∫ßn 1: ƒê√∫ng hay Sai?",
        "content": "‰∫õ (xiƒì)",
        "image": "https://placehold.co/600x400/2C3E50/FFF?text=Movie",
        "options": [
            "ƒê√∫ng",
            "Sai"
        ],
        "correct": 1
    },
    {
        "id": 25,
        "type": "reading",
        "section": "ƒê·ªçc - Ph·∫ßn 1: ƒê√∫ng hay Sai?",
        "content": "Âì™ÂÑø (n«ér)",
        "image": "https://placehold.co/600x400/2C3E50/FFF?text=Where",
        "options": [
            "ƒê√∫ng",
            "Sai"
        ],
        "correct": 0
    },
    {
        "id": 26,
        "type": "reading",
        "section": "ƒê·ªçc - Ph·∫ßn 2: Ch·ªçn h√¨nh",
        "content": "Ji«î di«én (9 gi·ªù)",
        "options": [
            "[Beijing]",
            "[Mr./Sir]",
            "[Nine]"
        ],
        "correct": 2
    },
    {
        "id": 27,
        "type": "reading",
        "section": "ƒê·ªçc - Ph·∫ßn 2: Ch·ªçn h√¨nh",
        "content": "Yƒ´ yu√® (Th√°ng 1)",
        "options": [
            "[Chinese language]",
            "[Weather]",
            "[Month]"
        ],
        "correct": 2
    },
    {
        "id": 28,
        "type": "reading",
        "section": "ƒê·ªçc - Ph·∫ßn 2: Ch·ªçn h√¨nh",
        "content": "Sh√©nme sh√≠hou? (Khi n√†o?)",
        "options": [
            "[Sit]",
            "[Time/Moment]",
            "[Look/Watch/Read]"
        ],
        "correct": 1
    },
    {
        "id": 29,
        "type": "reading",
        "section": "ƒê·ªçc - Ph·∫ßn 2: Ch·ªçn h√¨nh",
        "content": "N«ê ji√†o sh√©nme? (B·∫°n t√™n l√† g√¨?)",
        "options": [
            "[Like]",
            "[Call/Name]",
            "[Cup]"
        ],
        "correct": 1
    },
    {
        "id": 30,
        "type": "reading",
        "section": "ƒê·ªçc - Ph·∫ßn 2: Ch·ªçn h√¨nh",
        "content": "√àr bƒõn sh≈´ (2 quy·ªÉn s√°ch)",
        "options": [
            "[Which]",
            "[Two]",
            "[Home/Family]"
        ],
        "correct": 1
    },
    {
        "id": 31,
        "type": "reading",
        "section": "ƒê·ªçc - Ph·∫ßn 3: Ch·ªçn c√¢u tr·∫£ l·ªùi",
        "content": "N«ê ji√†o sh√©nme m√≠ngzi? (B·∫°n t√™n g√¨?)",
        "options": [
            "W«í ji√†o David",
            "Xi√®xie",
            "Z√†iji√†n"
        ],
        "correct": 0
    },
    {
        "id": 32,
        "type": "reading",
        "section": "ƒê·ªçc - Ph·∫ßn 3: Ch·ªçn c√¢u tr·∫£ l·ªùi",
        "content": "N«ê ji√†o sh√©nme m√≠ngzi? (B·∫°n t√™n g√¨?)",
        "options": [
            "W«í ji√†o David",
            "Xi√®xie",
            "Z√†iji√†n"
        ],
        "correct": 0
    },
    {
        "id": 33,
        "type": "reading",
        "section": "ƒê·ªçc - Ph·∫ßn 3: Ch·ªçn c√¢u tr·∫£ l·ªùi",
        "content": "N«ê ji√†o sh√©nme m√≠ngzi? (B·∫°n t√™n g√¨?)",
        "options": [
            "W«í ji√†o David",
            "Xi√®xie",
            "Z√†iji√†n"
        ],
        "correct": 0
    },
    {
        "id": 34,
        "type": "reading",
        "section": "ƒê·ªçc - Ph·∫ßn 3: Ch·ªçn c√¢u tr·∫£ l·ªùi",
        "content": "N«ê ji√†o sh√©nme m√≠ngzi? (B·∫°n t√™n g√¨?)",
        "options": [
            "W«í ji√†o David",
            "Xi√®xie",
            "Z√†iji√†n"
        ],
        "correct": 0
    },
    {
        "id": 35,
        "type": "reading",
        "section": "ƒê·ªçc - Ph·∫ßn 3: Ch·ªçn c√¢u tr·∫£ l·ªùi",
        "content": "N«ê ji√†o sh√©nme m√≠ngzi? (B·∫°n t√™n g√¨?)",
        "options": [
            "W«í ji√†o David",
            "Xi√®xie",
            "Z√†iji√†n"
        ],
        "correct": 0
    },
    {
        "id": 36,
        "type": "reading",
        "section": "ƒê·ªçc - Ph·∫ßn 4: ƒêi·ªÅn t·ª´",
        "content": "W«í ___ ‰π∞. (T√¥i ... Buy)",
        "options": [
            "Âùê",
            "‰∏úË•ø",
            "‰π∞"
        ],
        "correct": 2
    },
    {
        "id": 37,
        "type": "reading",
        "section": "ƒê·ªçc - Ph·∫ßn 4: ƒêi·ªÅn t·ª´",
        "content": "W«í ___ Áå´. (T√¥i ... Cat)",
        "options": [
            "Â•π",
            "Áå´",
            "ÊÄé‰πàÊ†∑"
        ],
        "correct": 1
    },
    {
        "id": 38,
        "type": "reading",
        "section": "ƒê·ªçc - Ph·∫ßn 4: ƒêi·ªÅn t·ª´",
        "content": "W«í ___ Êúâ. (T√¥i ... To have)",
        "options": [
            "ÂÖ≠",
            "Êúâ",
            "Êàë"
        ],
        "correct": 1
    },
    {
        "id": 39,
        "type": "reading",
        "section": "ƒê·ªçc - Ph·∫ßn 4: ƒêi·ªÅn t·ª´",
        "content": "W«í ___ ‰∏ãÂçà. (T√¥i ... Afternoon)",
        "options": [
            "Âè´",
            "Â§öÂ∞ë",
            "‰∏ãÂçà"
        ],
        "correct": 2
    },
    {
        "id": 40,
        "type": "reading",
        "section": "ƒê·ªçc - Ph·∫ßn 4: ƒêi·ªÅn t·ª´",
        "content": "W«í ___ ÁÅ´ËΩ¶Á´ô. (T√¥i ... Train Station)",
        "options": [
            "Êúà",
            "ÁÅ´ËΩ¶Á´ô",
            "Èáå"
        ],
        "correct": 1
    }
		];

        // --- CORE LOGIC ---
        let currentIdx = 0;
        let userAnswers = new Array(40).fill(null);
        let timeLeft = 40 * 60; // 40 ph√∫t
        let timerInterval;

        function init() {
            renderSidebar();
            loadQuestion(0);
            startTimer();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
                const s = (timeLeft % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${m}:${s}`;
                if (timeLeft <= 0) { clearInterval(timerInterval); alert("H·∫øt gi·ªù!"); submitTest(); }
            }, 1000);
        }

        function renderSidebar() {
            const listGrid = document.getElementById('grid-listening');
            const readGrid = document.getElementById('grid-reading');
            
            examData.forEach((q, idx) => {
                const div = document.createElement('div');
                div.className = `q-dot`;
                div.innerText = idx + 1;
                div.id = `dot-${idx}`;
                div.onclick = () => { loadQuestion(idx); if(window.innerWidth<=768) toggleSidebar(); };
                
                if (idx < 20) listGrid.appendChild(div);
                else readGrid.appendChild(div);
            });
        }

        function loadQuestion(idx) {
            currentIdx = idx;
            const q = examData[idx];
            
            // C·∫≠p nh·∫≠t UI
            document.getElementById('section-badge').innerText = q.section;
            document.getElementById('audio-control').style.display = q.type === 'listening' ? 'flex' : 'none';
            
            // Highlight sidebar
            document.querySelectorAll('.q-dot').forEach(d => d.classList.remove('active'));
            document.getElementById(`dot-${idx}`).classList.add('active');

            // Render N·ªôi dung
            let contentHtml = `<div class="q-text">${q.content}</div>`;
            if (q.image) contentHtml += `<div class="q-image-container"><img src="${q.image}" class="q-image" alt="Question Image"></div>`;
            document.getElementById('question-content').innerHTML = contentHtml;

            // Render ƒê√°p √°n
            const optsContainer = document.getElementById('options-container');
            optsContainer.innerHTML = "";
            const letters = ['A', 'B', 'C', 'D'];
            
            q.options.forEach((opt, optIdx) => {
                const btn = document.createElement('div');
                btn.className = `option-btn ${userAnswers[idx] === optIdx ? 'selected' : ''}`;
                // N·∫øu option l√† ƒê√∫ng/Sai th√¨ kh√¥ng c·∫ßn A,B,C
                const key = (q.options.length === 2) ? (optIdx === 0 ? '‚úî' : '‚úò') : letters[optIdx];
                
                btn.innerHTML = `<div class="option-key">${key}</div> <div>${opt}</div>`;
                btn.onclick = () => selectAnswer(idx, optIdx);
                optsContainer.appendChild(btn);
            });
        }

        function selectAnswer(qIdx, ansIdx) {
            userAnswers[qIdx] = ansIdx;
            loadQuestion(qIdx); // Re-render ƒë·ªÉ hi·ªán m√†u xanh
            document.getElementById(`dot-${qIdx}`).classList.add('answered');
        }

        function nextQuestion() { if (currentIdx < 39) loadQuestion(currentIdx + 1); }
        function prevQuestion() { if (currentIdx > 0) loadQuestion(currentIdx - 1); }

        function playAudio() {
            const text = examData[currentIdx].audioText;
            if (!text) return;
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'zh-CN'; u.rate = 0.8;
            window.speechSynthesis.speak(u);
        }

        function submitTest() {
            if(!confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën n·ªôp b√†i kh√¥ng?")) return;
            clearInterval(timerInterval);
            
            let score = 0;
            // M·ªói c√¢u 5 ƒëi·ªÉm (T·ªïng 200)
            examData.forEach((q, idx) => {
                if (userAnswers[idx] === q.correct) score += 5;
            });

            document.getElementById('resultModal').style.display = 'flex';
            document.getElementById('final-score').innerText = score;
            
            const msg = document.getElementById('pass-msg');
            if (score >= 120) {
                msg.innerText = "üéâ CH√öC M·ª™NG! B·∫†N ƒê√É ƒê·∫¨U HSK 1";
                msg.style.color = "var(--success)";
                triggerConfetti();
            } else {
                msg.innerText = "Chia bu·ªìn! B·∫°n c·∫ßn √¥n t·∫≠p th√™m (C·∫ßn 120ƒë).";
                msg.style.color = "var(--warning)";
            }

            if (window.saveTestResult) window.saveTestResult(score);
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        function triggerConfetti() {
            const script = document.createElement('script');
            script.src = "https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js";
            script.onload = () => confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            document.body.appendChild(script);
        }

        init();
    </script>
</body>
</html>