<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSK 1 - Mock Test (Auto Generated)</title>
    <link rel="icon" type="image/png" href="favicon-32x32.png">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* CSS GIá»® NGUYÃŠN NHÆ¯ CÅ¨ - CHá»ˆ COPY Láº I Äá»‚ Äáº¢M Báº¢O CHáº Y ÄÆ¯á»¢C */
        :root { --primary: #2C3E50; --accent: #FF4757; --bg: #F0F2F5; --white: #fff; --success: #2ED573; }
        body { font-family: 'Montserrat', 'Noto Sans SC', sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; color: #333; }
        .header { background: var(--white); padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); height: 60px; z-index: 20; }
        .timer-box { background: var(--primary); color: white; padding: 8px 20px; border-radius: 50px; font-weight: bold; font-size: 1.1rem; }
        #start-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 100; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; }
        .start-card { max-width: 500px; padding: 40px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); background: white; border-top: 5px solid var(--accent); }
        .start-btn { background: var(--accent); color: white; border: none; padding: 15px 40px; border-radius: 50px; font-size: 1.2rem; font-weight: bold; cursor: pointer; margin-top: 30px; transition: transform 0.2s; }
        .start-btn:hover { transform: scale(1.05); }
        .main-container { display: flex; flex: 1; overflow: hidden; position: relative; }
        .question-area { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; align-items: center; }
        .question-card { background: white; width: 100%; max-width: 800px; border-radius: 15px; padding: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); margin-bottom: 80px; transition: all 0.3s; }
        .question-card.example-mode { border: 2px solid #FFC107; background: #FFF9E6; }
        .example-tag { background: #FFC107; color: #333; padding: 5px 10px; border-radius: 5px; font-weight: bold; font-size: 0.8rem; margin-bottom: 10px; display: inline-block; }
        .section-badge { display: inline-block; background: #FFEBEE; color: var(--accent); padding: 5px 12px; border-radius: 20px; font-weight: 700; margin-bottom: 15px; font-size: 0.9rem; }
        .q-text { font-size: 1.3rem; font-weight: 600; margin-bottom: 20px; color: var(--primary); }
        .q-image-container img { max-height: 200px; border-radius: 8px; border: 2px solid #eee; margin: 10px 0; }
        .audio-control { background: #f8f9fa; padding: 12px 20px; border-radius: 50px; display: flex; align-items: center; gap: 10px; cursor: pointer; border: 1px solid #eee; margin-bottom: 20px; width: fit-content; transition: 0.2s; }
        .audio-control:hover { background: #eef2f5; transform: scale(1.02); }
        .options-grid { display: grid; gap: 15px; margin-top: 20px; width: 100%; }
        .option-btn { padding: 15px 20px; border: 2px solid #f0f0f0; border-radius: 12px; background: white; cursor: pointer; text-align: left; display: flex; align-items: center; gap: 15px; transition: 0.2s; }
        .option-btn:hover { border-color: var(--primary); background: #f8fbff; }
        .option-btn.selected { border-color: var(--accent); background: #FFF0F0; font-weight: 700; }
        .option-key { width: 30px; height: 30px; border-radius: 50%; background: #eee; display: flex; justify-content: center; align-items: center; font-weight: bold; flex-shrink: 0; }
        .option-btn.selected .option-key { background: var(--accent); color: white; }
        .options-grid.image-mode { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); }
        .option-image-card { border: 2px solid #f0f0f0; border-radius: 12px; cursor: pointer; overflow: hidden; transition: 0.2s; position: relative; }
        .option-image-card:hover { border-color: var(--primary); transform: translateY(-3px); }
        .option-image-card.selected { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(255,71,87,0.2); }
        .option-image-card img { width: 100%; height: 150px; object-fit: cover; display: block; }
        .img-key { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.6); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: bold; }
        .option-image-card.selected .img-key { background: var(--accent); }
        .sidebar { width: 300px; background: white; border-left: 1px solid #eee; display: flex; flex-direction: column; z-index: 10; }
        .q-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; padding: 15px; }
        .q-dot { aspect-ratio: 1; border-radius: 8px; background: #f5f5f5; display: flex; justify-content: center; align-items: center; cursor: pointer; font-size: 0.85rem; font-weight: 600; }
        .q-dot.active { border: 2px solid var(--accent); background: white; color: var(--accent); }
        .q-dot.answered { background: var(--primary); color: white; }
        .nav-buttons { position: fixed; bottom: 0; left: 0; right: 300px; padding: 15px 30px; background: white; border-top: 1px solid #eee; display: flex; justify-content: space-between; }
        .nav-btn { padding: 10px 30px; border-radius: 50px; border: none; cursor: pointer; font-weight: bold; }
        .submit-btn { width: 90%; margin: 20px auto; display: block; padding: 15px; background: var(--accent); color: white; border: none; border-radius: 50px; font-weight: bold; font-size: 1.1rem; cursor: pointer; }
        @media (max-width: 768px) { .sidebar { display: none; } .nav-buttons { right: 0; } }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 40px; border-radius: 20px; text-align: center; max-width: 400px; width: 90%; }
    </style>
</head>
<body>

    <div id="start-screen">
        <div class="start-card">
            <h1 style="color:var(--primary); margin-bottom:10px;">HSK 1 - MOCK TEST</h1>
            <p style="color:#666; font-size:1.1rem;">Äá» thi Ä‘Æ°á»£c táº¡o ngáº«u nhiÃªn má»—i láº§n thi</p>
            <div style="text-align:left; margin: 30px 0; background:#f8f9fa; padding:20px; border-radius:10px;">
                <p>ğŸ“ <b>Sá»‘ cÃ¢u há»i:</b> 40 cÃ¢u</p>
                <p>â± <b>Thá»i gian:</b> 40 phÃºt</p>
                <p>ğŸ² <b>Tráº¡ng thÃ¡i:</b> ÄÃ£ sinh Ä‘á» má»›i thÃ nh cÃ´ng!</p>
            </div>
            <button class="start-btn" onclick="startExam()">Báº®T Äáº¦U LÃ€M BÃ€I</button>
            <p style="margin-top:20px; font-size:0.9rem; cursor:pointer; color:#999;" onclick="window.location.href='index.html'">Quay láº¡i trang chá»§</p>
        </div>
    </div>

    <div class="header">
        <div style="font-weight:700; cursor:pointer" onclick="if(confirm('ThoÃ¡t bÃ i thi?')) window.location.href='index.html'">â¬… ThoÃ¡t</div>
        <div class="timer-box">â± <span id="timer">40:00</span></div>
        <div style="font-weight:700">HSK 1</div>
    </div>

    <div class="main-container">
        <div class="question-area">
            <div class="question-card" id="q-card">
                <div id="example-tag" style="display:none;" class="example-tag">VÃ Dá»¤ MáºªU (EXAMPLE)</div>
                <div class="section-badge" id="section-badge">Pháº§n thi</div>
                
                <div class="audio-control" id="audio-control" onclick="playAudio()">
                    <span style="font-size:1.5rem">ğŸ”Š</span> <span id="audio-text">Nghe cÃ¢u há»i</span>
                </div>

                <div id="question-content"></div>
                <div class="options-grid" id="options-container"></div>
            </div>

            <div class="nav-buttons">
                <button class="nav-btn" style="background:#eee" onclick="prevQuestion()">CÃ¢u trÆ°á»›c</button>
                <button class="nav-btn" style="background:var(--primary); color:white" onclick="nextQuestion()">CÃ¢u tiáº¿p theo</button>
            </div>
        </div>

        <div class="sidebar">
            <div style="padding:15px; border-bottom:1px solid #eee; font-weight:bold; text-align:center">DANH SÃCH CÃ‚U Há»I</div>
            <div style="flex:1; overflow-y:auto; padding:10px;">
                <div style="font-size:0.8rem; color:#999; margin:10px 0 5px 10px;">LISTENING</div>
                <div class="q-grid" id="grid-listening"></div>
                <div style="font-size:0.8rem; color:#999; margin:20px 0 5px 10px;">READING</div>
                <div class="q-grid" id="grid-reading"></div>
            </div>
            <div style="padding:20px; border-top:1px solid #eee;">
                <button class="submit-btn" onclick="submitTest()">Ná»˜P BÃ€I</button>
            </div>
        </div>
    </div>

    <div id="resultModal" class="modal">
        <div class="modal-content">
            <h2 style="color:var(--primary)">Káº¾T QUáº¢</h2>
            <div style="width:120px; height:120px; border-radius:50%; border:6px solid var(--accent); margin:20px auto; display:flex; justify-content:center; align-items:center; font-size:2.5rem; font-weight:800; color:var(--accent);">
                <span id="final-score">0</span>
            </div>
            <p id="pass-msg" style="font-weight:bold; font-size:1.1rem"></p>
            <button class="submit-btn" onclick="location.reload()">LÃ m Äá» KhÃ¡c</button>
            <button class="submit-btn" style="background:white; color:#333; border:1px solid #eee; margin-top:10px;" onclick="window.location.href='index.html'">Vá» Trang Chá»§</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
        import { getFirestore, doc, updateDoc, arrayUnion, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";
        const firebaseConfig = { apiKey: "AIzaSyBgc-OYf_lq9bTu_lQv46XbYtnEp4SBynY", authDomain: "hsk-plus-web.firebaseapp.com", projectId: "hsk-plus-web", storageBucket: "hsk-plus-web.firebasestorage.app", messagingSenderId: "757004452643", appId: "1:757004452643:web:cbef488f9d7699ac034296", measurementId: "G-8XVEFW19DQ" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let currentUser = null;
        onAuthStateChanged(auth, (user) => currentUser = user);
        window.saveTestResult = async function(score, total) {
            if (!currentUser) return;
            const userRef = doc(db, "users", currentUser.uid);
            try {
                const docSnap = await getDoc(userRef);
                const data = { testName: "HSK 1 Mock (Random)", score, total, date: new Date().toISOString(), pass: score >= 120 };
                if (!docSnap.exists()) await setDoc(userRef, { testHistory: [data] });
                else await updateDoc(userRef, { testHistory: arrayUnion(data) });
            } catch (e) { console.error(e); }
        }
    </script>

    <script>
        // --- 1. NGÃ‚N HÃ€NG Tá»ª Vá»°NG (ÄÃƒ CHUYá»‚N Tá»ª PYTHON SANG JS) ---
        const hsk1_vocab = [
            # --- DANH Tá»ª (Con ngÆ°á»i) ---
    {"word": "æˆ‘", "pinyin": "wÇ’", "meaning": "I/Me", "sentence": "WÇ’ shÃ¬ xuÃ©shÄ“ng (TÃ´i lÃ  há»c sinh)",
     "category": "pronoun"},
    {"word": "æˆ‘ä»¬", "pinyin": "wÇ’men", "meaning": "We/Us", "sentence": "WÇ’men qÃ¹ xuÃ©xiÃ o (ChÃºng tÃ´i Ä‘i trÆ°á»ng há»c)",
     "category": "pronoun"},
    {"word": "ä½ ", "pinyin": "nÇ", "meaning": "You", "sentence": "NÇ hÇo ma? (Báº¡n khá»e khÃ´ng?)", "category": "pronoun"},
    {"word": "ä»–", "pinyin": "tÄ", "meaning": "He/Him", "sentence": "TÄ shÃ¬ wÇ’ pÃ©ngyou (Anh áº¥y lÃ  báº¡n tÃ´i)",
     "category": "pronoun"},
    {"word": "å¥¹", "pinyin": "tÄ", "meaning": "She/Her", "sentence": "TÄ hÄ›n piÃ oliang (CÃ´ áº¥y ráº¥t Ä‘áº¹p)",
     "category": "pronoun"},
    {"word": "çˆ¸çˆ¸", "pinyin": "bÃ ba", "meaning": "Dad", "sentence": "WÇ’ bÃ ba shÃ¬ yÄ«shÄ“ng (Bá»‘ tÃ´i lÃ  bÃ¡c sÄ©)",
     "category": "noun"},
    {"word": "å¦ˆå¦ˆ", "pinyin": "mÄma", "meaning": "Mom", "sentence": "WÇ’ Ã i mÄma (TÃ´i yÃªu máº¹)", "category": "noun"},
    {"word": "å„¿å­", "pinyin": "Ã©rzi", "meaning": "Son", "sentence": "TÄ yÇ’u yÄ« ge Ã©rzi (Anh áº¥y cÃ³ 1 con trai)",
     "category": "noun"},
    {"word": "å¥³å„¿", "pinyin": "nÇš'Ã©r", "meaning": "Daughter", "sentence": "ZhÃ¨ shÃ¬ wÇ’ nÇš'Ã©r (ÄÃ¢y lÃ  con gÃ¡i tÃ´i)",
     "category": "noun"},
    {"word": "è€å¸ˆ", "pinyin": "lÇoshÄ«", "meaning": "Teacher", "sentence": "LÇoshÄ« hÇo (ChÃ o tháº§y/cÃ´)",
     "category": "noun"},
    {"word": "å­¦ç”Ÿ", "pinyin": "xuÃ©shÄ“ng", "meaning": "Student",
     "sentence": "WÇ’men shÃ¬ xuÃ©shÄ“ng (ChÃºng tÃ´i lÃ  há»c sinh)", "category": "noun"},
    {"word": "åŒå­¦", "pinyin": "tÃ³ngxuÃ©", "meaning": "Classmate",
     "sentence": "TÄ shÃ¬ wÇ’ tÃ³ngxuÃ© (CÃ´ áº¥y lÃ  báº¡n há»c cá»§a tÃ´i)", "category": "noun"},
    {"word": "æœ‹å‹", "pinyin": "pÃ©ngyou", "meaning": "Friend",
     "sentence": "NÇ shÃ¬ wÇ’ de hÇo pÃ©ngyou (Báº¡n lÃ  báº¡n tá»‘t cá»§a tÃ´i)", "category": "noun"},
    {"word": "åŒ»ç”Ÿ", "pinyin": "yÄ«shÄ“ng", "meaning": "Doctor", "sentence": "WÇ’ qÃ¹ kÃ n yÄ«shÄ“ng (TÃ´i Ä‘i khÃ¡m bÃ¡c sÄ©)",
     "category": "noun"},
    {"word": "å…ˆç”Ÿ", "pinyin": "xiÄnsheng", "meaning": "Mr./Sir",
     "sentence": "WÃ¡ng xiÄnsheng zÃ i ma? (Ã”ng VÆ°Æ¡ng cÃ³ Ä‘Ã³ khÃ´ng?)", "category": "noun"},
    {"word": "å°å§", "pinyin": "xiÇojiÄ›", "meaning": "Miss", "sentence": "LÇ xiÇojiÄ› hÄ›n gÄoxÃ¬ng (CÃ´ LÃ½ ráº¥t vui)",
     "category": "noun"},
    {"word": "äºº", "pinyin": "rÃ©n", "meaning": "Person", "sentence": "ZhÅngguÃ³ rÃ©n (NgÆ°á»i Trung Quá»‘c)",
     "category": "noun"},
    {"word": "åå­—", "pinyin": "mÃ­ngzi", "meaning": "Name", "sentence": "NÇ jiÃ o shÃ©nme mÃ­ngzi? (Báº¡n tÃªn lÃ  gÃ¬?)",
     "category": "noun"},

    # --- DANH Tá»ª (Äá»“ váº­t / NÆ¡i chá»‘n) ---
    {"word": "ä¹¦", "pinyin": "shÅ«", "meaning": "Book", "sentence": "WÇ’ kÃ n shÅ« (TÃ´i Ä‘á»c sÃ¡ch)", "category": "noun"},
    {"word": "æ¤…å­", "pinyin": "yÇzi", "meaning": "Chair", "sentence": "ZhÃ¨ shÃ¬ shÃ©i de yÇzi? (ÄÃ¢y lÃ  gháº¿ cá»§a ai?)",
     "category": "noun"},
    {"word": "æ¡Œå­", "pinyin": "zhuÅzi", "meaning": "Table", "sentence": "ShÅ« zÃ i zhuÅzi shÃ ng (SÃ¡ch á»Ÿ trÃªn bÃ n)",
     "category": "noun"},
    {"word": "æ¯å­", "pinyin": "bÄ“izi", "meaning": "Cup", "sentence": "YÄ« ge bÄ“izi (Má»™t cÃ¡i cá»‘c)", "category": "noun"},
    {"word": "ç”µè„‘", "pinyin": "diÃ nnÇo", "meaning": "Computer", "sentence": "WÇ’ mÇi diÃ nnÇo (TÃ´i mua mÃ¡y tÃ­nh)",
     "category": "noun"},
    {"word": "ç”µè§†", "pinyin": "diÃ nshÃ¬", "meaning": "Television", "sentence": "KÃ n diÃ nshÃ¬ (Xem TV)",
     "category": "noun"},
    {"word": "ç”µå½±", "pinyin": "diÃ nyÇng", "meaning": "Movie", "sentence": "QÃ¹ kÃ n diÃ nyÇng (Äi xem phim)",
     "category": "noun"},
    {"word": "é£æœº", "pinyin": "fÄ“ijÄ«", "meaning": "Airplane", "sentence": "WÇ’ zuÃ² fÄ“ijÄ« (TÃ´i ngá»“i mÃ¡y bay)",
     "category": "noun"},
    {"word": "å‡ºç§Ÿè½¦", "pinyin": "chÅ«zÅ«chÄ“", "meaning": "Taxi", "sentence": "WÇ’ jiÃ o chÅ«zÅ«chÄ“ (TÃ´i gá»i taxi)",
     "category": "noun"},
    {"word": "å®¶", "pinyin": "jiÄ", "meaning": "Home/Family", "sentence": "WÇ’ huÃ­ jiÄ (TÃ´i vá» nhÃ )",
     "category": "noun"},
    {"word": "å­¦æ ¡", "pinyin": "xuÃ©xiÃ o", "meaning": "School", "sentence": "WÇ’ qÃ¹ xuÃ©xiÃ o (TÃ´i Ä‘áº¿n trÆ°á»ng)",
     "category": "noun"},
    {"word": "é¥­åº—", "pinyin": "fÃ ndiÃ n", "meaning": "Restaurant/Hotel",
     "sentence": "QÃ¹ fÃ ndiÃ n chÄ« fÃ n (Äi nhÃ  hÃ ng Äƒn cÆ¡m)", "category": "noun"},
    {"word": "å•†åº—", "pinyin": "shÄngdiÃ n", "meaning": "Shop/Store",
     "sentence": "TÄ zÃ i shÄngdiÃ n mÇi dÅngxi (CÃ´ áº¥y mua Ä‘á»“ á»Ÿ cá»­a hÃ ng)", "category": "noun"},
    {"word": "åŒ»é™¢", "pinyin": "yÄ«yuÃ n", "meaning": "Hospital", "sentence": "YÄ«yuÃ n zÃ i nÇr? (Bá»‡nh viá»‡n á»Ÿ Ä‘Ã¢u?)",
     "category": "noun"},
    {"word": "ç«è½¦ç«™", "pinyin": "huÇ’chÄ“zhÃ n", "meaning": "Train Station",
     "sentence": "WÇ’ qÃ¹ huÇ’chÄ“zhÃ n (TÃ´i Ä‘i ga tÃ u há»a)", "category": "noun"},
    {"word": "ä¸­å›½", "pinyin": "ZhÅngguÃ³", "meaning": "China", "sentence": "WÇ’ Ã i ZhÅngguÃ³ (TÃ´i yÃªu Trung Quá»‘c)",
     "category": "noun"},
    {"word": "åŒ—äº¬", "pinyin": "BÄ›ijÄ«ng", "meaning": "Beijing", "sentence": "WÇ’ zhÃ¹ zÃ i BÄ›ijÄ«ng (TÃ´i sá»‘ng á»Ÿ Báº¯c Kinh)",
     "category": "noun"},
    {"word": "ä¸œè¥¿", "pinyin": "dÅngxi", "meaning": "Thing", "sentence": "MÇi dÅngxi (Mua Ä‘á»“)", "category": "noun"},
    {"word": "é’±", "pinyin": "qiÃ¡n", "meaning": "Money", "sentence": "DuÅshÇo qiÃ¡n? (Bao nhiÃªu tiá»n?)",
     "category": "noun"},
    {"word": "æ°´", "pinyin": "shuÇ", "meaning": "Water", "sentence": "HÄ“ shuÇ (Uá»‘ng nÆ°á»›c)", "category": "noun"},
    {"word": "èŒ¶", "pinyin": "chÃ¡", "meaning": "Tea", "sentence": "HÄ“ chÃ¡ (Uá»‘ng trÃ )", "category": "noun"},
    {"word": "ç±³é¥­", "pinyin": "mÇfÃ n", "meaning": "Rice", "sentence": "ChÄ« mÇfÃ n (Ä‚n cÆ¡m)", "category": "noun"},
    {"word": "èœ", "pinyin": "cÃ i", "meaning": "Dish/Vegetable", "sentence": "HÇochÄ« de cÃ i (MÃ³n Äƒn ngon)",
     "category": "noun"},
    {"word": "æ°´æœ", "pinyin": "shuÇguÇ’", "meaning": "Fruit", "sentence": "ChÄ« shuÇguÇ’ (Ä‚n trÃ¡i cÃ¢y)",
     "category": "noun"},
    {"word": "è‹¹æœ", "pinyin": "pÃ­ngguÇ’", "meaning": "Apple", "sentence": "ZhÃ¨ge pÃ­ngguÇ’ hÄ›n dÃ  (Quáº£ tÃ¡o nÃ y ráº¥t to)",
     "category": "noun"},
    {"word": "çŒ«", "pinyin": "mÄo", "meaning": "Cat", "sentence": "WÇ’ xÇhuan mÄo (TÃ´i thÃ­ch mÃ¨o)", "category": "noun"},
    {"word": "ç‹—", "pinyin": "gÇ’u", "meaning": "Dog", "sentence": "NÃ  shÃ¬ wÇ’ de gÇ’u (ÄÃ³ lÃ  chÃ³ cá»§a tÃ´i)",
     "category": "noun"},
    {"word": "è¡£æœ", "pinyin": "yÄ«fu", "meaning": "Clothes", "sentence": "PiÃ oliang de yÄ«fu (Quáº§n Ã¡o Ä‘áº¹p)",
     "category": "noun"},
    {"word": "å¤©æ°”", "pinyin": "tiÄnqÃ¬", "meaning": "Weather", "sentence": "TiÄnqÃ¬ hÄ›n hÇo (Thá»i tiáº¿t ráº¥t tá»‘t)",
     "category": "noun"},
    {"word": "å­—", "pinyin": "zÃ¬", "meaning": "Character", "sentence": "HÃ nzÃ¬ (Chá»¯ HÃ¡n)", "category": "noun"},
    {"word": "æ±‰è¯­", "pinyin": "HÃ nyÇ”", "meaning": "Chinese language", "sentence": "WÇ’ xuÃ© HÃ nyÇ” (TÃ´i há»c tiáº¿ng Trung)",
     "category": "noun"},

    # --- Sá» Äáº¾M & THá»œI GIAN ---
    {"word": "ä¸€", "pinyin": "yÄ«", "meaning": "One", "sentence": "YÄ« ge rÃ©n (1 ngÆ°á»i)", "category": "number"},
    {"word": "äºŒ", "pinyin": "Ã¨r", "meaning": "Two", "sentence": "Ãˆr bÄ›n shÅ« (2 quyá»ƒn sÃ¡ch)", "category": "number"},
    {"word": "ä¸‰", "pinyin": "sÄn", "meaning": "Three", "sentence": "SÄn ge (3 cÃ¡i)", "category": "number"},
    {"word": "å››", "pinyin": "sÃ¬", "meaning": "Four", "sentence": "SÃ¬ diÇn (4 giá»)", "category": "number"},
    {"word": "äº”", "pinyin": "wÇ”", "meaning": "Five", "sentence": "WÇ” tiÄn (5 ngÃ y)", "category": "number"},
    {"word": "å…­", "pinyin": "liÃ¹", "meaning": "Six", "sentence": "LiÃ¹ ge (6 cÃ¡i)", "category": "number"},
    {"word": "ä¸ƒ", "pinyin": "qÄ«", "meaning": "Seven", "sentence": "QÄ« yuÃ¨ (ThÃ¡ng 7)", "category": "number"},
    {"word": "å…«", "pinyin": "bÄ", "meaning": "Eight", "sentence": "BÄ ge (8 cÃ¡i)", "category": "number"},
    {"word": "ä¹", "pinyin": "jiÇ”", "meaning": "Nine", "sentence": "JiÇ” diÇn (9 giá»)", "category": "number"},
    {"word": "å", "pinyin": "shÃ­", "meaning": "Ten", "sentence": "ShÃ­ ge (10 cÃ¡i)", "category": "number"},
    {"word": "é›¶", "pinyin": "lÃ­ng", "meaning": "Zero", "sentence": "Ãˆr lÃ­ng Ã¨r liÃ¹ (2026)", "category": "number"},
    {"word": "ç‚¹", "pinyin": "diÇn", "meaning": "O'clock/Dot", "sentence": "BÄ diÇn (8 giá»)", "category": "time"},
    {"word": "åˆ†é’Ÿ", "pinyin": "fÄ“nzhÅng", "meaning": "Minute", "sentence": "SÄnshÃ­ fÄ“nzhÅng (30 phÃºt)",
     "category": "time"},
    {"word": "ç°åœ¨", "pinyin": "xiÃ nzÃ i", "meaning": "Now", "sentence": "XiÃ nzÃ i jÇ diÇn? (BÃ¢y giá» máº¥y giá»?)",
     "category": "time"},
    {"word": "æ—¶å€™", "pinyin": "shÃ­hou", "meaning": "Time/Moment", "sentence": "ShÃ©nme shÃ­hou? (Khi nÃ o?)",
     "category": "time"},
    {"word": "ä»Šå¤©", "pinyin": "jÄ«ntiÄn", "meaning": "Today", "sentence": "JÄ«ntiÄn hÄ›n rÃ¨ (HÃ´m nay ráº¥t nÃ³ng)",
     "category": "time"},
    {"word": "æ˜å¤©", "pinyin": "mÃ­ngtiÄn", "meaning": "Tomorrow", "sentence": "MÃ­ngtiÄn jiÃ n (Mai gáº·p láº¡i)",
     "category": "time"},
    {"word": "æ˜¨å¤©", "pinyin": "zuÃ³tiÄn", "meaning": "Yesterday",
     "sentence": "ZuÃ³tiÄn wÇ’ mÃ©i qÃ¹ (HÃ´m qua tÃ´i khÃ´ng Ä‘i)", "category": "time"},
    {"word": "ä¸Šåˆ", "pinyin": "shÃ ngwÇ”", "meaning": "Morning", "sentence": "ShÃ ngwÇ” hÇo (ChÃ o buá»•i sÃ¡ng)",
     "category": "time"},
    {"word": "ä¸­åˆ", "pinyin": "zhÅngwÇ”", "meaning": "Noon", "sentence": "ZhÅngwÇ” chÄ« shÃ©nme? (TrÆ°a Äƒn gÃ¬?)",
     "category": "time"},
    {"word": "ä¸‹åˆ", "pinyin": "xiÃ wÇ”", "meaning": "Afternoon", "sentence": "XiÃ wÇ” sÄn diÇn (3 giá» chiá»u)",
     "category": "time"},
    {"word": "å¹´", "pinyin": "niÃ¡n", "meaning": "Year", "sentence": "JÄ«nniÃ¡n (NÄƒm nay)", "category": "time"},
    {"word": "æœˆ", "pinyin": "yuÃ¨", "meaning": "Month", "sentence": "YÄ« yuÃ¨ (ThÃ¡ng 1)", "category": "time"},
    {"word": "æ—¥", "pinyin": "rÃ¬", "meaning": "Day/Sun", "sentence": "SÄn rÃ¬ (NgÃ y 3)", "category": "time"},
    {"word": "æ˜ŸæœŸ", "pinyin": "xÄ«ngqÄ«", "meaning": "Week", "sentence": "XÄ«ngqÄ« yÄ« (Thá»© hai)", "category": "time"},

    # --- Äá»˜NG Tá»ª ---
    {"word": "æ˜¯", "pinyin": "shÃ¬", "meaning": "To be (is/am/are)", "sentence": "WÇ’ shÃ¬ xuÃ©shÄ“ng (TÃ´i lÃ  há»c sinh)",
     "category": "verb"},
    {"word": "æœ‰", "pinyin": "yÇ’u", "meaning": "To have", "sentence": "WÇ’ yÇ’u qiÃ¡n (TÃ´i cÃ³ tiá»n)", "category": "verb"},
    {"word": "çœ‹", "pinyin": "kÃ n", "meaning": "Look/Watch/Read", "sentence": "KÃ n shÅ« (Äá»c sÃ¡ch)", "category": "verb"},
    {"word": "å¬", "pinyin": "tÄ«ng", "meaning": "Listen", "sentence": "TÄ«ng yÄ«nyuÃ¨ (Nghe nháº¡c)", "category": "verb"},
    {"word": "è¯´", "pinyin": "shuÅ", "meaning": "Speak/Say", "sentence": "ShuÅ HÃ nyÇ” (NÃ³i tiáº¿ng Trung)",
     "category": "verb"},
    {"word": "è¯»", "pinyin": "dÃº", "meaning": "Read", "sentence": "DÃº shÅ« (Äá»c sÃ¡ch)", "category": "verb"},
    {"word": "å†™", "pinyin": "xiÄ›", "meaning": "Write", "sentence": "XiÄ› zÃ¬ (Viáº¿t chá»¯)", "category": "verb"},
    {"word": "çœ‹è§", "pinyin": "kÃ njiÃ n", "meaning": "See (result)",
     "sentence": "WÇ’ kÃ njiÃ n tÄ le (TÃ´i nhÃ¬n tháº¥y anh áº¥y rá»“i)", "category": "verb"},
    {"word": "å«", "pinyin": "jiÃ o", "meaning": "Call/Name", "sentence": "NÇ jiÃ o shÃ©nme? (Báº¡n tÃªn lÃ  gÃ¬?)",
     "category": "verb"},
    {"word": "æ¥", "pinyin": "lÃ¡i", "meaning": "Come", "sentence": "TÄ lÃ¡i le ma? (Anh áº¥y Ä‘áº¿n chÆ°a?)",
     "category": "verb"},
    {"word": "å›", "pinyin": "huÃ­", "meaning": "Return", "sentence": "HuÃ­ jiÄ (Vá» nhÃ )", "category": "verb"},
    {"word": "å»", "pinyin": "qÃ¹", "meaning": "Go", "sentence": "QÃ¹ xuÃ©xiÃ o (Äi há»c)", "category": "verb"},
    {"word": "åƒ", "pinyin": "chÄ«", "meaning": "Eat", "sentence": "ChÄ« fÃ n (Ä‚n cÆ¡m)", "category": "verb"},
    {"word": "å–", "pinyin": "hÄ“", "meaning": "Drink", "sentence": "HÄ“ shuÇ (Uá»‘ng nÆ°á»›c)", "category": "verb"},
    {"word": "ç¡è§‰", "pinyin": "shuÃ¬jiÃ o", "meaning": "Sleep", "sentence": "WÇ’ yÃ o shuÃ¬jiÃ o (TÃ´i muá»‘n ngá»§)",
     "category": "verb"},
    {"word": "æ‰“ç”µè¯", "pinyin": "dÇ diÃ nhuÃ ", "meaning": "Call phone",
     "sentence": "GÄ›i mÄma dÇ diÃ nhuÃ  (Gá»i Ä‘iá»‡n cho máº¹)", "category": "verb"},
    {"word": "åš", "pinyin": "zuÃ²", "meaning": "Do/Make", "sentence": "ZuÃ² fÃ n (Náº¥u cÆ¡m)", "category": "verb"},
    {"word": "ä¹°", "pinyin": "mÇi", "meaning": "Buy", "sentence": "MÇi dÅngxi (Mua Ä‘á»“)", "category": "verb"},
    {"word": "å¼€", "pinyin": "kÄi", "meaning": "Open/Drive", "sentence": "KÄi chÄ“ (LÃ¡i xe)", "category": "verb"},
    {"word": "å", "pinyin": "zuÃ²", "meaning": "Sit", "sentence": "QÇng zuÃ² (Má»i ngá»“i)", "category": "verb"},
    {"word": "ä½", "pinyin": "zhÃ¹", "meaning": "Live", "sentence": "NÇ zhÃ¹ zÃ i nÇr? (Báº¡n sá»‘ng á»Ÿ Ä‘Ã¢u?)",
     "category": "verb"},
    {"word": "å­¦ä¹ ", "pinyin": "xuÃ©xÃ­", "meaning": "Study", "sentence": "XuÃ©xÃ­ HÃ nyÇ” (Há»c tiáº¿ng Trung)",
     "category": "verb"},
    {"word": "å·¥ä½œ", "pinyin": "gÅngzuÃ²", "meaning": "Work", "sentence": "WÇ’ zÃ i gÅngzuÃ² (TÃ´i Ä‘ang lÃ m viá»‡c)",
     "category": "verb"},
    {"word": "ä¸‹é›¨", "pinyin": "xiÃ  yÇ”", "meaning": "Rain", "sentence": "JÄ«ntiÄn xiÃ  yÇ” (HÃ´m nay trá»i mÆ°a)",
     "category": "verb"},
    {"word": "çˆ±", "pinyin": "Ã i", "meaning": "Love", "sentence": "WÇ’ Ã i nÇ (TÃ´i yÃªu báº¡n)", "category": "verb"},
    {"word": "å–œæ¬¢", "pinyin": "xÇhuan", "meaning": "Like", "sentence": "WÇ’ xÇhuan chÄ« (TÃ´i thÃ­ch Äƒn)",
     "category": "verb"},
    {"word": "æƒ³", "pinyin": "xiÇng", "meaning": "Want/Think", "sentence": "WÇ’ xiÇng qÃ¹ (TÃ´i muá»‘n Ä‘i)",
     "category": "verb"},
    {"word": "è®¤è¯†", "pinyin": "rÃ¨nshi", "meaning": "Know/Meet",
     "sentence": "RÃ¨nshi nÇ hÄ›n gÄoxÃ¬ng (Ráº¥t vui Ä‘Æ°á»£c quen báº¡n)", "category": "verb"},
    {"word": "ä¼š", "pinyin": "huÃ¬", "meaning": "Can", "sentence": "WÇ’ huÃ¬ shuÅ HÃ nyÇ” (TÃ´i biáº¿t nÃ³i tiáº¿ng Trung)",
     "category": "verb"},
    {"word": "èƒ½", "pinyin": "nÃ©ng", "meaning": "Can/Able to", "sentence": "WÇ’ nÃ©ng zuÃ² (TÃ´i cÃ³ thá»ƒ lÃ m)",
     "category": "verb"},

    # --- TÃNH Tá»ª ---
    {"word": "å¥½", "pinyin": "hÇo", "meaning": "Good", "sentence": "NÇ hÇo (ChÃ o báº¡n)", "category": "adjective"},
    {"word": "å¤š", "pinyin": "duÅ", "meaning": "Many/Much", "sentence": "HÄ›n duÅ (Ráº¥t nhiá»u)", "category": "adjective"},
    {"word": "å°‘", "pinyin": "shÇo", "meaning": "Few/Little", "sentence": "HÄ›n shÇo (Ráº¥t Ã­t)", "category": "adjective"},
    {"word": "å†·", "pinyin": "lÄ›ng", "meaning": "Cold", "sentence": "JÄ«ntiÄn hÄ›n lÄ›ng (HÃ´m nay ráº¥t láº¡nh)",
     "category": "adjective"},
    {"word": "çƒ­", "pinyin": "rÃ¨", "meaning": "Hot", "sentence": "TiÄnqÃ¬ hÄ›n rÃ¨ (Thá»i tiáº¿t ráº¥t nÃ³ng)",
     "category": "adjective"},
    {"word": "é«˜å…´", "pinyin": "gÄoxÃ¬ng", "meaning": "Happy", "sentence": "HÄ›n gÄoxÃ¬ng (Ráº¥t vui)",
     "category": "adjective"},
    {"word": "æ¼‚äº®", "pinyin": "piÃ oliang", "meaning": "Beautiful", "sentence": "TÄ hÄ›n piÃ oliang (CÃ´ áº¥y ráº¥t Ä‘áº¹p)",
     "category": "adjective"},
    {"word": "å¤§", "pinyin": "dÃ ", "meaning": "Big", "sentence": "FÃ¡ngzi hÄ›n dÃ  (NhÃ  ráº¥t to)", "category": "adjective"},
    {"word": "å°", "pinyin": "xiÇo", "meaning": "Small", "sentence": "GÇ’u hÄ›n xiÇo (ChÃ³ ráº¥t nhá»)",
     "category": "adjective"},

    # --- PHÃ“ Tá»ª & KHÃC ---
    {"word": "ä¸", "pinyin": "bÃ¹", "meaning": "No/Not", "sentence": "BÃ¹ hÇo (KhÃ´ng tá»‘t)", "category": "adverb"},
    {"word": "æ²¡", "pinyin": "mÃ©i", "meaning": "No (past/have)", "sentence": "WÇ’ mÃ©i yÇ’u (TÃ´i khÃ´ng cÃ³)",
     "category": "adverb"},
    {"word": "å¾ˆ", "pinyin": "hÄ›n", "meaning": "Very", "sentence": "HÄ›n hÇo (Ráº¥t tá»‘t)", "category": "adverb"},
    {"word": "å¤ª", "pinyin": "tÃ i", "meaning": "Too/Extremely", "sentence": "TÃ i dÃ  le (To quÃ¡)", "category": "adverb"},
    {"word": "éƒ½", "pinyin": "dÅu", "meaning": "All", "sentence": "WÇ’men dÅu qÃ¹ (ChÃºng tÃ´i Ä‘á»u Ä‘i)",
     "category": "adverb"},
    {"word": "å’Œ", "pinyin": "hÃ©", "meaning": "And", "sentence": "WÇ’ hÃ© nÇ (TÃ´i vÃ  báº¡n)", "category": "conjunction"},
    {"word": "åœ¨", "pinyin": "zÃ i", "meaning": "At/In", "sentence": "ZÃ i jiÄ (á» nhÃ )", "category": "preposition"},
    {"word": "é‡Œ", "pinyin": "lÇ", "meaning": "Inside", "sentence": "XuÃ©xiÃ o lÇ (Trong trÆ°á»ng)",
     "category": "position"},
    {"word": "ä¸Š", "pinyin": "shÃ ng", "meaning": "Up/On", "sentence": "ZhuÅzi shÃ ng (TrÃªn bÃ n)",
     "category": "position"},
    {"word": "ä¸‹", "pinyin": "xiÃ ", "meaning": "Down/Under", "sentence": "YÇzi xiÃ  (DÆ°á»›i gháº¿)", "category": "position"},
    {"word": "å‰", "pinyin": "qiÃ¡n", "meaning": "Front", "sentence": "QiÃ¡nmiÃ n (PhÃ­a trÆ°á»›c)", "category": "position"},
    {"word": "å", "pinyin": "hÃ²u", "meaning": "Back", "sentence": "HÃ²umiÃ n (PhÃ­a sau)", "category": "position"},
    {"word": "è¿™", "pinyin": "zhÃ¨", "meaning": "This", "sentence": "ZhÃ¨ shÃ¬ shÃ©nme? (ÄÃ¢y lÃ  gÃ¬?)",
     "category": "pronoun"},
    {"word": "é‚£", "pinyin": "nÃ ", "meaning": "That", "sentence": "NÃ  shÃ¬ shÅ« (ÄÃ³ lÃ  sÃ¡ch)", "category": "pronoun"},
    {"word": "å“ª", "pinyin": "nÇ", "meaning": "Which", "sentence": "NÇ ge? (CÃ¡i nÃ o?)", "category": "pronoun"},
    {"word": "å“ªå„¿", "pinyin": "nÇr", "meaning": "Where", "sentence": "NÇ zÃ i nÇr? (Báº¡n á»Ÿ Ä‘Ã¢u?)",
     "category": "pronoun"},
    {"word": "è°", "pinyin": "shÃ©i", "meaning": "Who", "sentence": "TÄ shÃ¬ shÃ©i? (Anh áº¥y lÃ  ai?)",
     "category": "pronoun"},
    {"word": "ä»€ä¹ˆ", "pinyin": "shÃ©nme", "meaning": "What", "sentence": "ShÃ©nme dÅngxi? (CÃ¡i gÃ¬?)",
     "category": "pronoun"},
    {"word": "å¤šå°‘", "pinyin": "duÅshao", "meaning": "How many/much", "sentence": "DuÅshÇo qiÃ¡n? (Bao nhiÃªu tiá»n?)",
     "category": "pronoun"},
    {"word": "å‡ ", "pinyin": "jÇ", "meaning": "How many (<10)", "sentence": "JÇ ge rÃ©n? (Máº¥y ngÆ°á»i?)",
     "category": "pronoun"},
    {"word": "æ€ä¹ˆ", "pinyin": "zÄ›nme", "meaning": "How", "sentence": "ZÄ›nme qÃ¹? (Äi tháº¿ nÃ o?)", "category": "pronoun"},
    {"word": "æ€ä¹ˆæ ·", "pinyin": "zÄ›nmeyÃ ng", "meaning": "How about",
     "sentence": "TiÄnqÃ¬ zÄ›nmeyÃ ng? (Thá»i tiáº¿t tháº¿ nÃ o?)", "category": "pronoun"},
    {"word": "çš„", "pinyin": "de", "meaning": "Of (possessive)", "sentence": "WÇ’ de shÅ« (SÃ¡ch cá»§a tÃ´i)",
     "category": "particle"},
    {"word": "äº†", "pinyin": "le", "meaning": "Past tense marker", "sentence": "TÄ lÃ¡i le (Anh áº¥y Ä‘áº¿n rá»“i)",
     "category": "particle"},
    {"word": "å—", "pinyin": "ma", "meaning": "Question particle", "sentence": "HÇo ma? (ÄÆ°á»£c khÃ´ng?)",
     "category": "particle"},
    {"word": "å‘¢", "pinyin": "ne", "meaning": "Question particle", "sentence": "NÇ ne? (CÃ²n báº¡n?)",
     "category": "particle"},
    {"word": "å–‚", "pinyin": "wÃ¨i", "meaning": "Hello (phone)", "sentence": "WÃ¨i, nÇ hÇo (Alo, xin chÃ o)",
     "category": "interjection"},
    {"word": "è°¢è°¢", "pinyin": "xiÃ¨xie", "meaning": "Thanks", "sentence": "XiÃ¨xie nÇ (Cáº£m Æ¡n báº¡n)",
     "category": "phrase"},
    {"word": "ä¸å®¢æ°”", "pinyin": "bÃº kÃ¨qi", "meaning": "You're welcome", "sentence": "BÃº kÃ¨qi (KhÃ´ng cÃ³ chi)",
     "category": "phrase"},
    {"word": "å†è§", "pinyin": "zÃ ijiÃ n", "meaning": "Goodbye", "sentence": "MÃ­ngtiÄn jiÃ n (Mai gáº·p)",
     "category": "phrase"},
    {"word": "å¯¹ä¸èµ·", "pinyin": "duÃ¬buqÇ", "meaning": "Sorry", "sentence": "DuÃ¬buqÇ (Xin lá»—i)", "category": "phrase"},
    {"word": "æ²¡å…³ç³»", "pinyin": "mÃ©i guÄnxi", "meaning": "No problem", "sentence": "MÃ©i guÄnxi (KhÃ´ng sao Ä‘Ã¢u)",
     "category": "phrase"},
    {"word": "ä¸ª", "pinyin": "gÃ¨", "meaning": "Measure word", "sentence": "YÄ« ge rÃ©n (1 ngÆ°á»i)", "category": "measure"},
    {"word": "æœ¬", "pinyin": "bÄ›n", "meaning": "Measure word (book)", "sentence": "YÄ« bÄ›n shÅ« (1 quyá»ƒn sÃ¡ch)",
     "category": "measure"},
    {"word": "äº›", "pinyin": "xiÄ“", "meaning": "Some", "sentence": "ZhÃ¨xiÄ“ (Nhá»¯ng cÃ¡i nÃ y)", "category": "measure"},
    {"word": "å—", "pinyin": "kuÃ i", "meaning": "Piece/Yuan", "sentence": "YÄ« kuÃ i qiÃ¡n (1 Ä‘á»“ng)",
     "category": "measure"},
    {"word": "å²", "pinyin": "suÃ¬", "meaning": "Years old", "sentence": "WÇ’ bÄ suÃ¬ (TÃ´i 8 tuá»•i)", "category": "measure"}
        ];

        const qa_pairs = [
            {"q": "NÇ jiÃ o shÃ©nme?", "a": "WÇ’ jiÃ o David"},
            {"q": "XiÃ¨xie!", "a": "BÃº kÃ¨qi"},
            {"q": "ZÃ ijiÃ n!", "a": "MÃ­ngtiÄn jiÃ n"},
            {"q": "DuÅshÇo qiÃ¡n?", "a": "WÇ” kuÃ i"},
            {"q": "NÇ qÃ¹ nÇr?", "a": "HuÃ­ jiÄ"},
            {"q": "JÄ«ntiÄn jÇ hÃ o?", "a": "BÄ hÃ o"},
            {"q": "TÄ shÃ¬ shÃ©i?", "a": "WÇ’ lÇoshÄ«"}
        ];

        // --- 2. HÃ€M Há»– TRá»¢ (TÆ¯Æ NG Tá»° PYTHON) ---
        function getImg(text) {
            return `https://placehold.co/400x300/2C3E50/FFF?text=${text.replace(/ /g, '+')}`;
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function getDistractors(target, count) {
            const pool = hsk1_vocab.filter(x => x !== target);
            return shuffle(pool).slice(0, count);
        }

        function getRandomItem() {
            return hsk1_vocab[Math.floor(Math.random() * hsk1_vocab.length)];
        }

        // --- 3. HÃ€M SINH Äá»€ THI (CHáº Y KHI VÃ€O TRANG) ---
        let examData = [];
        let globalId = 1;

        function addQ(type, section, content, audio, img, opts, correct, optType='text', isExample=false) {
            examData.push({
                id: globalId,
                isExample, type, section, content, audioText: audio, image: img,
                options: opts, optionType: optType, correct
            });
            if (!isExample) globalId++;
        }

        function generateExam() {
            examData = [];
            globalId = 1;

            // --- LISTENING ---
            // Part 1: ÄÃºng/Sai
            addQ("listening", "Nghe P1: ÄÃºng/Sai", "WÇ’ hÄ›n gÄoxÃ¬ng (Vui váº»)", "WÇ’ hÄ›n gÄoxÃ¬ng", getImg("Happy"), ["ÄÃºng", "Sai"], 0, "text", true);
            for(let i=0; i<5; i++) {
                const item = getRandomItem();
                const isTrue = Math.random() < 0.5;
                const display = isTrue ? item : getRandomItem();
                addQ("listening", "Nghe P1: ÄÃºng/Sai", `${item.word} (${item.meaning})`, item.word, getImg(display.meaning), ["ÄÃºng", "Sai"], isTrue ? 0 : 1);
            }

            // Part 2: Chá»n HÃ¬nh
            addQ("listening", "Nghe P2: Chá»n hÃ¬nh", "Nghe vÃ  chá»n hÃ¬nh:", "ZhÃ¨ shÃ¬ shÅ«", null, [getImg("Book"), getImg("Dog"), getImg("Car")], 0, "image", true);
            for(let i=0; i<5; i++) {
                const target = getRandomItem();
                const dist = getDistractors(target, 2);
                let opts = [target, ...dist];
                opts = shuffle(opts);
                const imgOpts = opts.map(x => getImg(x.meaning));
                addQ("listening", "Nghe P2: Chá»n hÃ¬nh", "Nghe cÃ¢u vÃ  chá»n hÃ¬nh:", target.sentence, null, imgOpts, opts.indexOf(target), "image");
            }

            // Part 3: Há»™i thoáº¡i
            addQ("listening", "Nghe P3: Há»™i thoáº¡i", "Nghe há»™i thoáº¡i chá»n hÃ¬nh:", "A: NÇ hÇo! B: NÇ hÇo!", null, [getImg("Hello"), getImg("Bye"), getImg("Eat")], 0, "image", true);
            for(let i=0; i<5; i++) {
                const target = getRandomItem();
                const dist = getDistractors(target, 2);
                let opts = [target, ...dist];
                opts = shuffle(opts);
                const imgOpts = opts.map(x => getImg(x.meaning));
                addQ("listening", "Nghe P3: Há»™i thoáº¡i", "Nghe há»™i thoáº¡i vÃ  chá»n hÃ¬nh:", `A: NÇ xÇhuan ${target.pinyin} ma? \n B: HÄ›n xÇhuan!`, null, imgOpts, opts.indexOf(target), "image");
            }

            // Part 4: Chá»n Text
            addQ("listening", "Nghe P4: Chá»n Ä‘Ã¡p Ã¡n", "Chá»n cÃ¢u tráº£ lá»i:", "TÄ zÃ i nÇr?", null, ["ZÃ i jiÄ", "ChÄ« fÃ n", "XuÃ©xiÃ o"], 0, "text", true);
            for(let i=0; i<5; i++) {
                const target = getRandomItem();
                const dist = getDistractors(target, 2);
                let opts = [target.word, dist[0].word, dist[1].word];
                opts = shuffle(opts);
                addQ("listening", "Nghe P4: Chá»n Ä‘Ã¡p Ã¡n", `ZhÃ¨ shÃ¬ shÃ©nme? - ${target.meaning}`, null, null, opts, opts.indexOf(target.word), "text");
            }

            // --- READING ---
            // Part 1: ÄÃºng/Sai
            addQ("reading", "Äá»c P1: ÄÃºng/Sai", "DiÃ nnÇo (MÃ¡y tÃ­nh)", null, getImg("Computer"), ["ÄÃºng", "Sai"], 0, "text", true);
            for(let i=0; i<5; i++) {
                const item = getRandomItem();
                const isTrue = Math.random() < 0.5;
                const display = isTrue ? item : getRandomItem();
                addQ("reading", "Äá»c P1: ÄÃºng/Sai", `${item.word} (${item.pinyin})`, null, getImg(display.meaning), ["ÄÃºng", "Sai"], isTrue ? 0 : 1);
            }

            // Part 2: Chá»n HÃ¬nh
            addQ("reading", "Äá»c P2: Chá»n hÃ¬nh", "WÇ’ hÄ“ chÃ¡.", null, null, [getImg("Tea"), getImg("Rice"), getImg("Water")], 0, "image", true);
            for(let i=0; i<5; i++) {
                const target = getRandomItem();
                const dist = getDistractors(target, 2);
                let opts = [target, ...dist];
                opts = shuffle(opts);
                const imgOpts = opts.map(x => getImg(x.meaning));
                addQ("reading", "Äá»c P2: Chá»n hÃ¬nh", target.sentence, null, null, imgOpts, opts.indexOf(target), "image");
            }

            // Part 3: Há»i ÄÃ¡p
            addQ("reading", "Äá»c P3: Há»i ÄÃ¡p", "NÇ hÇo ma?", null, null, ["HÄ›n hÇo", "XiÃ¨xie", "DuÃ¬buqÇ"], 0, "text", true);
            const pairs = shuffle([...qa_pairs]).slice(0, 5);
            for(let p of pairs) {
                const target = p.a;
                const others = qa_pairs.filter(x => x.a !== target).map(x => x.a);
                const dist = shuffle(others).slice(0, 2);
                let opts = shuffle([target, ...dist]);
                addQ("reading", "Äá»c P3: Há»i ÄÃ¡p", p.q, null, null, opts, opts.indexOf(target));
            }

            // Part 4: Äiá»n tá»«
            addQ("reading", "Äá»c P4: Äiá»n tá»«", "WÇ’ ___ xuÃ©shÄ“ng (TÃ´i lÃ  HS).", null, null, ["shÃ¬", "bÃ¹", "hÇo"], 0, "text", true);
            for(let i=0; i<5; i++) {
                const target = getRandomItem();
                const dist = getDistractors(target, 2);
                let opts = shuffle([target.word, dist[0].word, dist[1].word]);
                addQ("reading", "Äá»c P4: Äiá»n tá»«", `WÇ’ ___ ${target.word}.`, null, null, opts, opts.indexOf(target.word));
            }
        }

        // --- LOGIC GIAO DIá»†N (VIEW) ---
        let currentIdx = 0;
        let userAnswers = [];
        let timerInterval;
        let timeLeft = 40 * 60;

        // Táº O Äá»€ NGAY Láº¬P Tá»¨C
        generateExam();
        userAnswers = new Array(examData.length).fill(null);

        function startExam() {
            document.getElementById('start-screen').style.display = 'none';
            renderSidebar();
            loadQuestion(0);
            timerInterval = setInterval(() => {
                timeLeft--;
                const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
                const s = (timeLeft % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${m}:${s}`;
                if (timeLeft <= 0) { clearInterval(timerInterval); submitTest(); }
            }, 1000);
        }

        function renderSidebar() {
            const listGrid = document.getElementById('grid-listening');
            const readGrid = document.getElementById('grid-reading');
            listGrid.innerHTML = ""; readGrid.innerHTML = "";

            examData.forEach((q, idx) => {
                if (q.isExample) return;
                const div = document.createElement('div');
                div.className = 'q-dot';
                div.innerText = q.id;
                div.id = `dot-${idx}`;
                div.onclick = () => loadQuestion(idx);
                if (q.type === 'listening') listGrid.appendChild(div);
                else readGrid.appendChild(div);
            });
        }

        function loadQuestion(idx) {
            currentIdx = idx;
            const q = examData[idx];
            const card = document.getElementById('q-card');
            const exTag = document.getElementById('example-tag');
            
            if (q.isExample) {
                card.classList.add('example-mode');
                exTag.style.display = 'inline-block';
            } else {
                card.classList.remove('example-mode');
                exTag.style.display = 'none';
                document.querySelectorAll('.q-dot').forEach(d => d.classList.remove('active'));
                const dot = document.getElementById(`dot-${idx}`);
                if (dot) dot.classList.add('active');
            }

            document.getElementById('section-badge').innerText = q.section;
            document.getElementById('audio-control').style.display = q.type === 'listening' ? 'flex' : 'none';

            let html = `<div class="q-text">${q.content}</div>`;
            if (q.image) html += `<div class="q-image-container"><img src="${q.image}"></div>`;
            document.getElementById('question-content').innerHTML = html;

            const container = document.getElementById('options-container');
            container.innerHTML = "";
            const letters = ['A', 'B', 'C', 'D'];

            if (q.optionType === 'image') {
                container.className = "options-grid image-mode";
                q.options.forEach((optImg, i) => {
                    const div = document.createElement('div');
                    div.className = `option-image-card ${userAnswers[idx] === i ? 'selected' : ''}`;
                    div.innerHTML = `<img src="${optImg}"><div class="img-key">${letters[i]}</div>`;
                    div.onclick = () => selectAnswer(idx, i);
                    container.appendChild(div);
                });
            } else {
                container.className = "options-grid";
                q.options.forEach((optText, i) => {
                    const div = document.createElement('div');
                    div.className = `option-btn ${userAnswers[idx] === i ? 'selected' : ''}`;
                    let key = letters[i];
                    if (q.options.length === 2) key = (i === 0) ? 'âœ”' : 'âœ˜';
                    div.innerHTML = `<div class="option-key">${key}</div><div>${optText}</div>`;
                    div.onclick = () => selectAnswer(idx, i);
                    container.appendChild(div);
                });
            }
        }

        function selectAnswer(qIdx, ansIdx) {
            if (examData[qIdx].isExample) return;
            userAnswers[qIdx] = ansIdx;
            loadQuestion(qIdx);
            const dot = document.getElementById(`dot-${qIdx}`);
            if(dot) dot.classList.add('answered');
        }

        function nextQuestion() { if (currentIdx < examData.length - 1) loadQuestion(currentIdx + 1); }
        function prevQuestion() { if (currentIdx > 0) loadQuestion(currentIdx - 1); }
        function playAudio() {
            if (!examData[currentIdx].audioText) return;
            const u = new SpeechSynthesisUtterance(examData[currentIdx].audioText);
            u.lang = 'zh-CN'; u.rate = 0.8;
            window.speechSynthesis.speak(u);
        }

        function submitTest() {
            if(!confirm("Ná»™p bÃ i ngay?")) return;
            clearInterval(timerInterval);
            let correctCount = 0;
            let realQuestions = 0;
            examData.forEach((q, idx) => {
                if (!q.isExample) {
                    realQuestions++;
                    if (userAnswers[idx] === q.correct) correctCount++;
                }
            });
            const score = Math.round((correctCount / realQuestions) * 200);
            document.getElementById('resultModal').style.display = 'flex';
            document.getElementById('final-score').innerText = score;
            const msg = document.getElementById('pass-msg');
            if (score >= 120) {
                msg.innerText = "ğŸ‰ Äáº¬U Rá»’I! (PASS)";
                msg.style.color = "var(--success)";
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            } else {
                msg.innerText = "Cáº¦N Cá» Gáº®NG HÆ N (FAIL)";
                msg.style.color = "var(--accent)";
            }
            if(window.saveTestResult) window.saveTestResult(score, 200);
        }
    </script>
</body>
</html>